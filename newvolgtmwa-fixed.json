{
  "name": "newvolgtm",
  "nodes": [
    {
      "parameters": {
        "operation": "upsert",
        "table": "jobs",
        "columnToMatchOn": "job_id",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2,
      "position": [
        -320,
        1408
      ],
      "id": "a47199f8-1a6c-4b25-8b3b-bd7a2398e279",
      "name": "MySQL Insert",
      "credentials": {
        "mySql": {
          "id": "Mmz0SsGmSZ76dUMn",
          "name": "MySQL account 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1776,
        1312
      ],
      "id": "19a92570-f5fd-4eb0-831f-370ac97e6734",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "path": "jobs-ui",
        "responseMode": "responseNode",
        "options": {},
        "authentication": "headerAuth"
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -400,
        816
      ],
      "id": "fd6aac74-08a0-4614-926c-1c1b459fe08d",
      "name": "Jobs UI (GET)",
      "webhookId": "7ca4db1d-6e14-4652-8a72-bcbbebbc6aa6",
      "credentials": {
        "httpHeaderAuth": {
          "id": "WEBHOOK_AUTH_CRED_ID",
          "name": "Webhook Auth Header"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM jobs ORDER BY job_posted_at_datetime_utc DESC LIMIT 50",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2,
      "position": [
        176,
        816
      ],
      "id": "5ea917a7-a24f-42df-a836-2825cb8d849b",
      "name": "Fetch Jobs for UI (MySQL)",
      "credentials": {
        "mySql": {
          "id": "Mmz0SsGmSZ76dUMn",
          "name": "MySQL account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const html = `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n  <title>Jobs Selection</title>\n  <style>\n    :root {\n      --bg: #f4f6fb;\n      --card: #ffffff;\n      --muted: #5f6b82;\n      --text: #1a1d2e;\n      --accent: #d48a2e;\n      --accent-2: #2a8fa8;\n      --border: #d8dde8;\n      --chip: #eaecf3;\n      --shadow: 0 12px 30px rgba(0,0,0,0.08);\n    }\n    * { box-sizing: border-box; }\n    body {\n      margin: 0;\n      font-family: \"Space Grotesk\", \"Satoshi\", \"Segoe UI\", sans-serif;\n      background: radial-gradient(1200px 600px at 10% -20%, #dce6f0 0%, transparent 60%),\n                  radial-gradient(800px 500px at 90% -10%, #f0e8e8 0%, transparent 60%),\n                  var(--bg);\n      color: var(--text);\n    }\n    header {\n      padding: 28px 28px 12px;\n      display: flex;\n      align-items: flex-end;\n      justify-content: space-between;\n      gap: 16px;\n    }\n    h1 {\n      margin: 0;\n      font-size: 28px;\n      letter-spacing: 0.2px;\n    }\n    .sub {\n      color: var(--muted);\n      font-size: 14px;\n      margin-top: 6px;\n    }\n    .stats {\n      display: flex;\n      gap: 12px;\n      flex-wrap: wrap;\n    }\n    .chip {\n      background: var(--chip);\n      border: 1px solid var(--border);\n      border-radius: 999px;\n      padding: 6px 12px;\n      font-size: 12px;\n      color: var(--muted);\n    }\n    .container {\n      padding: 0 24px 32px;\n      display: grid;\n      grid-template-columns: 1fr;\n      gap: 16px;\n    }\n    .panel {\n      background: var(--card);\n      border: 1px solid var(--border);\n      border-radius: 14px;\n      box-shadow: var(--shadow);\n      padding: 16px;\n    }\n    .filters {\n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n      gap: 12px;\n    }\n    input, select, button, textarea {\n      font: inherit;\n      color: var(--text);\n    }\n    input, select {\n      background: #f0f2f7;\n      border: 1px solid var(--border);\n      border-radius: 10px;\n      padding: 10px 12px;\n      width: 100%;\n      outline: none;\n    }\n    button {\n      background: linear-gradient(135deg, var(--accent), #e8b96a);\n      border: none;\n      color: #1b1b1b;\n      padding: 10px 14px;\n      border-radius: 10px;\n      cursor: pointer;\n      font-weight: 600;\n    }\n    button.secondary {\n      background: transparent;\n      border: 1px solid var(--border);\n      color: var(--text);\n    }\n    .table-wrap {\n      overflow: auto;\n      border-radius: 12px;\n      border: 1px solid var(--border);\n      background: #f9fafb;\n    }\n    table {\n      width: 100%;\n      border-collapse: collapse;\n      min-width: 720px;\n    }\n    thead th {\n      position: sticky;\n      top: 0;\n      background: #eef0f5;\n      text-align: left;\n      font-size: 12px;\n      text-transform: uppercase;\n      letter-spacing: 0.08em;\n      padding: 12px;\n      border-bottom: 1px solid var(--border);\n    }\n    tbody td {\n      padding: 12px;\n      border-bottom: 1px solid var(--border);\n      font-size: 14px;\n    }\n    tbody tr:hover {\n      background: rgba(0,0,0,0.03);\n    }\n    .row-title {\n      font-weight: 600;\n      margin-bottom: 4px;\n    }\n    .row-meta {\n      color: var(--muted);\n      font-size: 12px;\n    }\n    .badge {\n      display: inline-block;\n      padding: 4px 8px;\n      border-radius: 999px;\n      background: rgba(42,143,168,0.12);\n      color: var(--accent-2);\n      font-size: 11px;\n      border: 1px solid rgba(42,143,168,0.25);\n    }\n    .footer-bar {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 12px;\n      flex-wrap: wrap;\n    }\n    .selected-list {\n      max-height: 120px;\n      overflow: auto;\n      border: 1px dashed var(--border);\n      padding: 8px;\n      border-radius: 10px;\n      background: #f4f6fb;\n      font-size: 12px;\n      color: var(--muted);\n    }\n    .action-row {\n      display: flex;\n      gap: 10px;\n      flex-wrap: wrap;\n      align-items: center;\n    }\n    .pagination {\n      display: flex;\n      gap: 8px;\n      align-items: center;\n      color: var(--muted);\n      font-size: 13px;\n    }\n    .empty {\n      text-align: center;\n      padding: 40px;\n      color: var(--muted);\n    }\n    .modal-overlay {\n      position: fixed;\n      inset: 0;\n      background: rgba(0,0,0,0.35);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 9999;\n      opacity: 0;\n      transition: opacity 0.2s;\n    }\n    .modal-overlay.active { opacity: 1; }\n    .modal-box {\n      background: var(--card);\n      border: 1px solid var(--border);\n      border-radius: 16px;\n      box-shadow: 0 24px 60px rgba(0,0,0,0.18);\n      width: 680px;\n      max-width: 92vw;\n      max-height: 82vh;\n      display: flex;\n      flex-direction: column;\n      overflow: hidden;\n      transform: translateY(12px);\n      transition: transform 0.2s;\n    }\n    .modal-overlay.active .modal-box { transform: translateY(0); }\n    .modal-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 18px 22px;\n      border-bottom: 1px solid var(--border);\n    }\n    .modal-header h2 {\n      margin: 0;\n      font-size: 18px;\n      font-weight: 700;\n      color: var(--text);\n    }\n    .modal-close {\n      background: var(--chip);\n      border: 1px solid var(--border);\n      color: var(--muted);\n      width: 32px;\n      height: 32px;\n      border-radius: 8px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      font-size: 18px;\n      font-weight: 600;\n      padding: 0;\n      line-height: 1;\n    }\n    .modal-close:hover { color: var(--text); }\n    .modal-body {\n      padding: 22px;\n      overflow-y: auto;\n      flex: 1;\n      color: var(--text);\n      font-size: 14px;\n      line-height: 1.7;\n    }\n    .modal-body p { margin: 0 0 12px; }\n    .modal-body ul, .modal-body ol { margin: 0 0 12px; padding-left: 22px; }\n    .modal-body li { margin-bottom: 4px; }\n    .modal-body h3, .modal-body h4 {\n      margin: 18px 0 8px;\n      font-size: 15px;\n      color: var(--accent-2);\n    }\n    .modal-meta {\n      display: flex;\n      gap: 12px;\n      flex-wrap: wrap;\n      margin-bottom: 16px;\n    }\n    .modal-meta .chip {\n      font-size: 12px;\n    }\n    .btn-view {\n      background: var(--chip);\n      border: 1px solid var(--border);\n      color: var(--accent-2);\n      padding: 5px 12px;\n      border-radius: 8px;\n      cursor: pointer;\n      font-size: 12px;\n      font-weight: 600;\n    }\n    .btn-view:hover {\n      border-color: var(--accent-2);\n      background: rgba(42,143,168,0.08);\n    }\n    @media (max-width: 780px) {\n      header {\n        flex-direction: column;\n        align-items: flex-start;\n      }\n    }\n  </style>\n</head>\n<body>\n  <header>\n    <div>\n      <h1>Job Selection Console</h1>\n      <div class=\"sub\">Pick jobs to advance in the workflow. Latest records are loaded from Database.</div>\n    </div>\n    <div class=\"stats\">\n      <div class=\"chip\" id=\"total-count\">0 jobs</div>\n      <div class=\"chip\" id=\"filtered-count\">0 shown</div>\n      <div class=\"chip\" id=\"selected-count\">0 selected</div>\n    </div>\n  </header>\n\n  <div class=\"container\">\n    <div class=\"panel\">\n      <div class=\"filters\">\n        <input id=\"search\" type=\"text\" placeholder=\"Search title, company, location...\" />\n        <select id=\"filter-remote\">\n          <option value=\"\">Remote + On-site</option>\n          <option value=\"remote\">Remote only</option>\n          <option value=\"onsite\">On-site only</option>\n        </select>\n        <input id=\"filter-type\" type=\"text\" placeholder=\"Employment type (e.g., Full-time)\" />\n        <select id=\"sort\">\n          <option value=\"recent\">Sort by recent</option>\n          <option value=\"company\">Sort by company</option>\n          <option value=\"title\">Sort by title</option>\n        </select>\n      </div>\n    </div>\n\n    <div class=\"panel\">\n      <div class=\"table-wrap\">\n        <table>\n          <thead>\n            <tr>\n              <th style=\"width: 48px;\"><input id=\"toggle-all\" type=\"checkbox\" /></th>\n              <th>Role</th>\n              <th>Company</th>\n              <th>Location</th>\n              <th>Type</th>\n              <th>Remote</th>\n              <th>Posted</th>\n              <th>Link</th>\n              <th style=\"text-align:center;\">Job Description</th>\n            </tr>\n          </thead>\n          <tbody id=\"table-body\"></tbody>\n        </table>\n        <div id=\"empty\" class=\"empty\" style=\"display:none;\">No jobs match the current filters.</div>\n      </div>\n    </div>\n\n    <div class=\"panel\">\n      <div class=\"footer-bar\">\n        <div class=\"pagination\">\n          <button class=\"secondary\" id=\"prev-page\">Prev</button>\n          <span id=\"page-status\">Page 1</span>\n          <button class=\"secondary\" id=\"next-page\">Next</button>\n        </div>\n        <div class=\"action-row\">\n          <button class=\"secondary\" id=\"clear-selection\">Clear selection</button>\n          <button id=\"submit-selection\">Proceed</button>\n        </div>\n      </div>\n      <div style=\"margin-top: 12px;\">\n        <div class=\"sub\" style=\"margin-bottom: 6px;\">Selected jobs</div>\n        <div id=\"selected-list\" class=\"selected-list\"></div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"modal-overlay\" id=\"desc-modal\" style=\"display:none;\">\n    <div class=\"modal-box\">\n      <div class=\"modal-header\">\n        <h2 id=\"modal-title\">Job Description</h2>\n        <button class=\"modal-close\" id=\"modal-close\">&times;</button>\n      </div>\n      <div id=\"modal-meta\" class=\"modal-meta\" style=\"padding:16px 22px 0;\"></div>\n      <div class=\"modal-body\" id=\"modal-body\"></div>\n    </div>\n  </div>\n\n  <script>\n    const state = {\n      page: 1,\n      perPage: 12,\n      search: '',\n      remote: '',\n      type: '',\n      sort: 'recent',\n      selected: new Set(),\n      allJobs: [],\n      jobs: [],\n      total: 0,\n      loading: false,\n    };\n\n    const esc = (s) => {\n      if (s == null) return '';\n      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\"/g,'&quot;').replace(/'/g,'&#x27;');\n    };\n    const el = (id) => document.getElementById(id);\n    const tableBody = el('table-body');\n    const empty = el('empty');\n    const totalCount = el('total-count');\n    const filteredCount = el('filtered-count');\n    const selectedCount = el('selected-count');\n    const selectedList = el('selected-list');\n\n    const formatDate = (value) => {\n      if (!value) return 'N/A';\n      const d = new Date(value);\n      if (Number.isNaN(d.getTime())) return value;\n      return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });\n    };\n\n    const getBase = () => {\n      const useTest = window.location.pathname.includes('/webhook-test/');\n      return window.location.origin + (useTest ? '/webhook-test/' : '/webhook/');\n    };\n\n    const loadData = async () => {\n      state.loading = true;\n      const params = new URLSearchParams({\n        q: state.search || '',\n        remote: state.remote || '',\n        type: state.type || '',\n        sort: state.sort || 'recent',\n      });\n\n      const url = \\`\\${getBase()}jobs-ui-data?\\${params}\\`;\n      try {\n        const res = await fetch(url);\n        if (!res.ok) throw new Error(\\`HTTP \\${res.status}\\`);\n        const raw = await res.text();\n        let payload;\n        try { payload = JSON.parse(raw); } catch(pe) { throw new Error('Invalid JSON: ' + raw.substring(0, 200)); }\n        const list = Array.isArray(payload) ? payload : (Array.isArray(payload.items) ? payload.items : []);\n        state.allJobs = list;\n        state.total = state.allJobs.length;\n      } catch (err) {\n        console.error('loadData error:', err);\n        state.allJobs = [];\n        state.total = 0;\n        empty.textContent = 'Error loading jobs: ' + err.message;\n        empty.style.display = 'block';\n      } finally {\n        state.loading = false;\n        render();\n      }\n    };\n\n    const render = () => {\n      const totalPages = Math.max(1, Math.ceil(state.total / state.perPage) || 1);\n      state.page = Math.min(state.page, totalPages);\n      const start = (state.page - 1) * state.perPage;\n      state.jobs = state.allJobs.slice(start, start + state.perPage);\n\n      totalCount.textContent = \\`\\${state.total} jobs\\`;\n      filteredCount.textContent = \\`\\${state.jobs.length} shown\\`;\n      selectedCount.textContent = \\`\\${state.selected.size} selected\\`;\n\n      tableBody.innerHTML = '';\n      if (!state.jobs.length) {\n        empty.style.display = 'block';\n      } else {\n        empty.style.display = 'none';\n      }\n\n      state.jobs.forEach((job) => {\n        const tr = document.createElement('tr');\n        const checked = state.selected.has(job.id);\n        tr.innerHTML = \\`\n          <td><input type=\"checkbox\" data-id=\"\\${esc(job.id)}\" \\${checked ? 'checked' : ''} /></td>\n          <td><div class=\"row-title\">\\${esc(job.title)}</div></td>\n          <td>\\${esc(job.company)}</td>\n          <td>\\${esc(job.location)}</td>\n          <td>\\${esc(job.employmentType || 'N/A')}</td>\n          <td>\\${job.remote ? '<span class=\"badge\">Remote</span>' : 'On-site'}</td>\n          <td>\\${esc(formatDate(job.postedAt || job.createdAt))}</td>\n          <td>\\${job.url ? \\`<a href=\"\\${esc(job.url)}\" target=\"_blank\" rel=\"noopener\" style=\"color: var(--accent-2);\">Open</a>\\` : 'N/A'}</td>\n          <td style=\"text-align:center;\">\\${job.description ? \\`<button class=\"btn-view\" data-idx=\"\\${state.jobs.indexOf(job)}\">View</button>\\` : '<span style=\"color:var(--muted);font-size:12px;\">N/A</span>'}</td>\n        \\`;\n        tableBody.appendChild(tr);\n      });\n\n      el('page-status').textContent = \\`Page \\${state.page} of \\${totalPages}\\`;\n      renderSelectedList();\n    };\n\n    const renderSelectedList = () => {\n      if (!state.selected.size) {\n        selectedList.textContent = 'No jobs selected yet.';\n        return;\n      }\n      const selectedJobs = state.jobs.filter(j => state.selected.has(j.id));\n      if (!selectedJobs.length) {\n        selectedList.textContent = \\`\\${state.selected.size} jobs selected across pages.\\`;\n        return;\n      }\n      selectedList.innerHTML = selectedJobs.map(j => esc(j.title) + ' â€” ' + esc(j.company)).join('<br />');\n    };\n\n    const debounce = (fn, delay) => {\n      let t;\n      return (...args) => {\n        clearTimeout(t);\n        t = setTimeout(() => fn(...args), delay);\n      };\n    };\n\n    tableBody.addEventListener('change', (event) => {\n      const target = event.target;\n      if (target && target.matches('input[type=\"checkbox\"][data-id]')) {\n        const id = target.getAttribute('data-id');\n        if (target.checked) state.selected.add(id);\n        else state.selected.delete(id);\n        selectedCount.textContent = \\`\\${state.selected.size} selected\\`;\n        renderSelectedList();\n      }\n    });\n\n    el('toggle-all').addEventListener('change', (event) => {\n      const checked = event.target.checked;\n      state.jobs.forEach((job) => {\n        if (checked) state.selected.add(job.id);\n        else state.selected.delete(job.id);\n      });\n      render();\n    });\n\n    el('search').addEventListener('input', debounce((e) => {\n      state.search = e.target.value.trim();\n      state.page = 1;\n      loadData();\n    }, 300));\n\n    el('filter-remote').addEventListener('change', (e) => {\n      state.remote = e.target.value;\n      state.page = 1;\n      loadData();\n    });\n\n    el('filter-type').addEventListener('input', debounce((e) => {\n      state.type = e.target.value.trim();\n      state.page = 1;\n      loadData();\n    }, 300));\n\n    el('sort').addEventListener('change', (e) => {\n      state.sort = e.target.value;\n      state.page = 1;\n      loadData();\n    });\n\n    el('prev-page').addEventListener('click', () => {\n      state.page = Math.max(1, state.page - 1);\n      render();\n    });\n\n    el('next-page').addEventListener('click', () => {\n      const maxPage = Math.max(1, Math.ceil(state.total / state.perPage));\n      state.page = Math.min(maxPage, state.page + 1);\n      render();\n    });\n\n    el('clear-selection').addEventListener('click', () => {\n      state.selected.clear();\n      render();\n    });\n\n    el('submit-selection').addEventListener('click', async () => {\n      if (!state.selected.size) {\n        alert('Select at least one job to continue.');\n        return;\n      }\n      // Show loading overlay\n      const overlay = document.createElement('div');\n      overlay.id = 'loading-overlay';\n      overlay.style.cssText = 'position:fixed;inset:0;background:rgba(255,255,255,0.92);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;';\n      overlay.innerHTML = '<div style=\"text-align:center;\"><div style=\"width:48px;height:48px;border:3px solid #d8dde8;border-top-color:#d48a2e;border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 20px;\"></div><div style=\"font-size:20px;font-weight:600;margin-bottom:8px;color:#1a1d2e;\">Processing selected jobs...</div><div style=\"color:#5f6b82;font-size:14px;\">Searching for company leaders. This may take a minute.</div></div>';\n      const styleTag = document.createElement('style');\n      styleTag.textContent = '@keyframes spin{to{transform:rotate(360deg)}}';\n      document.head.appendChild(styleTag);\n      document.body.appendChild(overlay);\n\n      const base = getBase();\n      const url = base + 'jobs-ui-submit';\n      const payload = { selectedJobIds: Array.from(state.selected) };\n\n      try {\n        const res = await fetch(url, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload),\n        });\n        if (!res.ok) throw new Error(\\`HTTP \\${res.status}\\`);\n        const html = await res.text();\n        if (!html || html.trim().length < 50) throw new Error('Empty or invalid response from server');\n        document.open();\n        document.write(html);\n        document.close();\n      } catch (err) {\n        const ov = document.getElementById('loading-overlay');\n        if (ov) ov.remove();\n        alert('Submit failed: ' + err.message + '. Check n8n execution logs.');\n        console.error(err);\n      }\n    });\n\n    const descModal = el('desc-modal');\n    const modalTitle = el('modal-title');\n    const modalMeta = el('modal-meta');\n    const modalBody = el('modal-body');\n\n    const formatDesc = (raw) => {\n      if (!raw) return '<p style=\"color:var(--muted);font-style:italic;\">No description available.</p>';\n      var LF = String.fromCharCode(10);\n      var CR = String.fromCharCode(13);\n      var text = String(raw);\n      text = text.split('&').join('&amp;').split('<').join('&lt;').split('>').join('&gt;');\n      text = text.split(CR + LF).join(LF).split(CR).join(LF);\n      var blocks = text.split(LF + LF);\n      var html = blocks.map(function(b) {\n        var trimmed = b.split(LF).join('<br/>');\n        return trimmed.trim() ? '<p>' + trimmed + '</p>' : '';\n      }).join('');\n      return html || '<p>' + text.split(LF).join('<br/>') + '</p>';\n    };\n\n    const openModal = (job) => {\n      modalTitle.textContent = job.title || 'Job Description';\n      modalMeta.innerHTML = '<span class=\"chip\">' + esc(job.company || '') + '</span>' + '<span class=\"chip\">' + esc(job.location || '') + '</span>' + (job.employmentType ? '<span class=\"chip\">' + esc(job.employmentType) + '</span>' : '') + (job.remote ? '<span class=\"chip\" style=\"border-color:var(--accent-2);color:var(--accent-2);\">Remote</span>' : '');\n      modalBody.innerHTML = formatDesc(job.description);\n      descModal.style.display = 'flex';\n      requestAnimationFrame(() => descModal.classList.add('active'));\n    };\n\n    const closeModal = () => {\n      descModal.classList.remove('active');\n      setTimeout(() => { descModal.style.display = 'none'; }, 200);\n    };\n\n    el('modal-close').addEventListener('click', closeModal);\n    descModal.addEventListener('click', (e) => { if (e.target === descModal) closeModal(); });\n    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });\n\n    tableBody.addEventListener('click', (e) => {\n      const btn = e.target.closest('.btn-view');\n      if (!btn) return;\n      const idx = parseInt(btn.dataset.idx, 10);\n      const job = state.jobs[idx];\n      if (job) openModal(job);\n    });\n\n    loadData();\n  </script>\n</body>\n</html>`;\n\nreturn [{ json: { html } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -96,
        1040
      ],
      "id": "501dfc35-888f-4c3f-a677-34854b835040",
      "name": "Build Jobs UI HTML (Server)"
    },
    {
      "parameters": {
        "path": "jobs-ui-data",
        "responseMode": "responseNode",
        "options": {},
        "authentication": "headerAuth"
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -400,
        1024
      ],
      "id": "8938e46d-2592-42f1-ac07-a87b3015ab4b",
      "name": "Jobs UI Data (GET)",
      "webhookId": "739b31a2-c257-4254-bf0a-4dd3872095e6",
      "credentials": {
        "httpHeaderAuth": {
          "id": "WEBHOOK_AUTH_CRED_ID",
          "name": "Webhook Auth Header"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const query = $json.query || $json || {};\nconst search = String(query.q || '').trim();\nconst sort = String(query.sort || 'recent').trim();\n\nlet where = '1=1';\nif (search) {\n  // Strip everything except alphanumeric, spaces, hyphens, dots, commas\n  const safe = search.replace(/[^a-zA-Z0-9 .,\\-]/g, '');\n  if (safe.length > 0 && safe.length <= 200) {\n    where += \" AND (job_title LIKE '%\" + safe + \"%' OR employer_name LIKE '%\" + safe + \"%' OR job_location LIKE '%\" + safe + \"%')\";\n  }\n}\nif (query.remote === 'remote') where += \" AND job_is_remote = 1\";\nif (query.remote === 'onsite') where += \" AND job_is_remote = 0\";\nif (query.type) {\n  const safeType = String(query.type).replace(/[^a-zA-Z0-9 ,\\-]/g, '');\n  if (safeType.length > 0 && safeType.length <= 100) {\n    where += \" AND job_employment_type LIKE '%\" + safeType + \"%'\";\n  }\n}\n\nconst sortAllowlist = { 'recent': 'job_posted_at_datetime_utc DESC', 'company': 'employer_name ASC', 'title': 'job_title ASC' };\nconst orderBy = sortAllowlist[sort] || 'job_posted_at_datetime_utc DESC';\n\nconst sql = \"SELECT * FROM jobs WHERE \" + where + \" ORDER BY \" + orderBy + \" LIMIT 500\";\nreturn [{ json: { query: sql } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        16,
        1312
      ],
      "id": "bb760cc8-04ac-49ba-a727-699f64a2bcc2",
      "name": "Build Jobs Data Query"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "={{$json.query}}",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2,
      "position": [
        256,
        1312
      ],
      "id": "3609a488-cf15-43dc-897d-311a04c30500",
      "name": "Fetch Jobs Data (MySQL)",
      "credentials": {
        "mySql": {
          "id": "Mmz0SsGmSZ76dUMn",
          "name": "MySQL account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "try {\n  const response = $input.all().map(item => item.json);\n  const total = response.length;\n  const items = response.map((j) => ({\n    id: String(j.job_id || j.id || ''),\n    title: j.job_title || 'Untitled role',\n    company: j.employer_name || 'Unknown company',\n    location: j.job_location || [j.job_city, j.job_state].filter(Boolean).join(', ') || 'Location N/A',\n    country: j.job_country || '',\n    employmentType: j.job_employment_type || '',\n    remote: Boolean(j.job_is_remote),\n    postedAt: j.job_posted_at_datetime_utc || j.job_posted_at || '',\n    url: j.job_apply_link || j.job_google_link || '',\n    createdAt: j.created_at || '',\n    description: j.job_description || ''\n  }));\n  return [{ json: { items, total } }];\n} catch (err) {\n  return [{ json: { items: [], total: 0, error: err.message } }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        496,
        1312
      ],
      "id": "717391b1-0060-40d1-8eed-441fb75149cf",
      "name": "Build Jobs Data Response"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{JSON.stringify($json)}}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json; charset=UTF-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        736,
        1312
      ],
      "id": "ca31717c-e914-4176-937d-cc09be8059e4",
      "name": "Jobs Data Response"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.html}}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=UTF-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        496,
        1104
      ],
      "id": "ffc83db2-b045-48ca-af52-1d8f038443ab",
      "name": "Jobs UI Response"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "jobs-ui-submit",
        "responseMode": "responseNode",
        "options": {},
        "authentication": "headerAuth"
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -192,
        1760
      ],
      "id": "3a88d33e-42c5-49e9-91d3-fb1d7a1ef3d4",
      "name": "Jobs UI Submit (POST)",
      "webhookId": "b229f389-b6e5-483d-987b-c21047af9039",
      "credentials": {
        "httpHeaderAuth": {
          "id": "WEBHOOK_AUTH_CRED_ID",
          "name": "Webhook Auth Header"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const payload = $json.body || $json;\nlet selectedIds = payload.selectedJobIds || payload.selectedIds || payload.ids || [];\nif (typeof selectedIds === 'string') {\n  try { selectedIds = JSON.parse(selectedIds); } catch (e) { selectedIds = selectedIds.split(','); }\n}\nconst selectedList = Array.isArray(selectedIds) ? selectedIds : [selectedIds];\n\n// Validate and sanitize: only allow alphanumeric, hyphens, underscores (typical job IDs)\nconst safeIds = selectedList\n  .map(id => String(id).trim())\n  .filter(id => id.length > 0 && id.length <= 128 && /^[a-zA-Z0-9_\\-]+$/.test(id))\n  .slice(0, 100);\n\nif (safeIds.length === 0) return [{ json: { query: \"SELECT * FROM jobs WHERE 1=0\" } }];\n\nconst ids = safeIds.map(id => \"'\" + id + \"'\").join(',');\nreturn [{ json: { query: \"SELECT * FROM jobs WHERE job_id IN (\" + ids + \")\" } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        16,
        1488
      ],
      "id": "29506443-f71e-4dd5-8305-dc71e1baef77",
      "name": "Build Submit Query"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "={{$json.query}}",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2,
      "position": [
        256,
        1488
      ],
      "id": "443a39f5-1206-433b-899f-a810e51817de",
      "name": "Fetch Selected Jobs (MySQL)",
      "credentials": {
        "mySql": {
          "id": "Mmz0SsGmSZ76dUMn",
          "name": "MySQL account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all().map(i => i.json);\nreturn items.map((row) => ({ json: row }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        496,
        1488
      ],
      "id": "2fb65210-e479-40a4-a79c-23f2cf535122",
      "name": "Filter Selected Jobs (Submit)"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.html}}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=UTF-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        2528,
        1488
      ],
      "id": "1a082f47-6b3e-41b2-ae0a-9a4fbb798889",
      "name": "Selection Response"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 9 * * 1-5"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -1792,
        1552
      ],
      "id": "b10b268d-bde9-40de-850a-bb4affd2e2bb",
      "name": "Daily Schedule (9AM EST)2"
    },
    {
      "parameters": {
        "url": "https://jsearch.p.rapidapi.com/search",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "= {{ $json.keyword }} jobs in UK"
            },
            {
              "name": "page",
              "value": "1"
            },
            {
              "name": "num_pages",
              "value": "1"
            },
            {
              "name": "country",
              "value": "gb"
            },
            {
              "name": "date_posted",
              "value": "month"
            },
            {
              "name": "employment_types",
              "value": "FULLTIME, CONTRACTOR, PARTTIME, INTERN"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-rapidapi-host",
              "value": "jsearch.p.rapidapi.com"
            }
          ]
        },
        "options": {
          "batching": {
            "batch": {
              "batchSize": 1,
              "batchInterval": 10000
            }
          },
          "timeout": 60000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1040,
        1472
      ],
      "id": "425cf9fa-c058-404b-973c-f7ccfb31b77f",
      "name": "Job Scraper2",
      "retryOnFail": true,
      "waitBetweenTries": 15000,
      "maxTries": 5,
      "credentials": {
        "httpHeaderAuth": {
          "id": "cMvU3IrfuYisILxD",
          "name": "RapidAPI JSearch"
        }
      },
      "onError": "continueErrorOutput",
      "notes": "âš ï¸ SECURITY: Move x-rapidapi-key to n8n Credentials!\n\nRapidAPI JSearch - Fetches GTM/Clay jobs from the past week."
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -784,
        1648
      ],
      "id": "7ec51eb3-311e-4209-a796-60e85047c100",
      "name": "Split Out2"
    },
    {
      "parameters": {
        "jsCode": "return $input.all().map(item => {\n  const j = item.json;\n  return {\n    json: {\n      job_id: j.job_id,\n      job_title: j.job_title,\n      employer_name: j.employer_name,\n      job_location: j.job_location,\n      job_country: j.job_country,\n      job_employment_type: j.job_employment_type,\n      job_is_remote: j.job_is_remote ? 1 : 0,\n      job_posted_at_datetime_utc: j.job_posted_at_datetime_utc ? new Date(j.job_posted_at_datetime_utc).toISOString().slice(0, 19).replace('T', ' ') : null,\n      job_apply_link: j.job_apply_link,\n      job_google_link: j.job_google_link,\n      job_description: j.job_description || ''\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -576,
        1648
      ],
      "id": "3493b033-e075-492b-94aa-89b5520fc2f4",
      "name": "Prepare Job Data"
    },
    {
      "parameters": {
        "sendTo": "sohom@insightstap.com",
        "subject": "=ðŸš¨ GTM Workflow Error: {{ $json.error.code || 429 }} at Jsearch API from RapidAPi",
        "emailType": "text",
        "message": "=Hello, \n\nThe GTM Research workflow has encountered an error.\n\n--- ERROR SUMMARY ---\nNode: JobSearch\nError Type: {{ $json.error.code || \"Unknown Error\" }} \nStatus Code: {{ $json.status || $json.error?.httpCode || 429 }}\n\n--- DETAILED MESSAGE ---\n{{ $json.message || $json.error?.message || \"No message provided.\" }}\n\n--- TECHNICAL DETAILS ---\n{{ $json.stack ? $json.stack.split('\\n')[0] : \"Check execution logs for stack trace.\" }}\n\n--- ACTION REQUIRED ---\nFix the issue and continue execution.",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        -704,
        1120
      ],
      "id": "b4dec29c-24e0-43c6-b338-e3e4c705f209",
      "name": "Error Alert - Job Scraper",
      "webhookId": "2ad56aa9-1932-4aa6-8bad-cc3305fd7db8",
      "credentials": {
        "gmailOAuth2": {
          "id": "v1wrpbcHjokyVyuA",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "return [\n  { json: { keyword: \"GTM Engineer\" } },\n  { json: { keyword: \"Go To Market Engineer\" } },\n  { json: { keyword: \"Clay GTM\" } }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1456,
        1472
      ],
      "id": "0056ba22-5329-42a7-9248-dbd6aebdf288",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1248,
        1472
      ],
      "id": "0888603a-6f3b-49a5-b392-b78aebe1f0a6",
      "name": "Wait",
      "webhookId": "d50aa357-6071-4fdb-961c-053e3dee6d1f"
    },
    {
      "parameters": {
        "jsCode": "const data = $items(\"Save People to DB\")[0].json;\nconst allPeople = data.allPeople || [];\nconst companiesSearched = data.companiesSearched || 0;\nconst totalPeople = data.totalPeople || 0;\nconst searchBatchId = data.searchBatchId || '';\n\nconst esc = (s) => String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\"/g,'&quot;');\n\n// Group people by company, suggested first\nconst grouped = {};\nfor (const p of allPeople) {\n  if (!grouped[p.company]) grouped[p.company] = { suggested: [], others: [] };\n  if (p.is_suggested) {\n    grouped[p.company].suggested.push(p);\n  } else {\n    grouped[p.company].others.push(p);\n  }\n}\n\nconst suggestedCount = allPeople.filter(p => p.is_suggested).length;\nconst companies = Object.keys(grouped);\n\nlet peopleHtml = '';\nlet compIdx = 0;\nfor (const companyName of companies) {\n  const grp = grouped[companyName];\n  const all = [...grp.suggested, ...grp.others];\n  const sj = all[0] || {};\n  \n  peopleHtml += '<div class=\"company-section\" data-company=\"' + compIdx + '\">';\n  peopleHtml += '<div class=\"company-header\">';\n  peopleHtml += '<div class=\"company-header-left\">';\n  peopleHtml += '<label class=\"cb-wrap\"><input type=\"checkbox\" class=\"company-select-all\" data-company=\"' + compIdx + '\" /><span class=\"checkmark\"></span></label>';\n  peopleHtml += '<div><div class=\"company-name\">' + esc(companyName) + '</div>';\n  peopleHtml += '<div class=\"company-meta\">' + all.length + ' people found';\n  if (grp.suggested.length > 0) peopleHtml += ' &middot; ' + grp.suggested.length + ' AI suggested';\n  if (sj.sourceJobTitle) peopleHtml += ' &middot; Source: ' + esc(sj.sourceJobTitle);\n  peopleHtml += '</div></div></div></div>';\n  \n  for (const p of all) {\n    const skillsHtml = (p.skills || []).slice(0, 6).map(s => '<span class=\"skill\">' + esc(s) + '</span>').join('');\n    const expHtml = (p.experience || []).slice(0, 2).map(e => '<div class=\"exp-item\">' + esc(e) + '</div>').join('');\n    const otwBadge = p.openToWork ? '<span class=\"badge otw\">Open to work</span>' : '';\n    const sugBadge = p.is_suggested ? '<span class=\"badge ai-sug\">AI Suggested</span>' : '';\n    const reasonHtml = p.is_suggested && p.suggestion_reason ? '<div class=\"sug-reason\">' + esc(p.suggestion_reason) + '</div>' : '';\n    \n    peopleHtml += '<div class=\"person-row' + (p.is_suggested ? ' suggested' : '') + '\">';\n    peopleHtml += '<label class=\"cb-wrap\"><input type=\"checkbox\" class=\"person-cb\" data-company=\"' + compIdx + '\" data-uid=\"' + esc(p.uid) + '\" /><span class=\"checkmark\"></span></label>';\n    peopleHtml += '<div class=\"person-info\">';\n    peopleHtml += '<div class=\"person-name-line\"><span class=\"person-name\">' + esc(p.fullName) + '</span>' + sugBadge + otwBadge + '</div>';\n    peopleHtml += '<div class=\"person-title\">' + esc(p.currentTitle) + '</div>';\n    peopleHtml += '<div class=\"person-location\">' + esc(p.location) + '</div>';\n    peopleHtml += reasonHtml;\n    peopleHtml += '<div class=\"person-skills\">' + (skillsHtml || '') + '</div>';\n    peopleHtml += '<div class=\"person-exp\">' + (expHtml || '') + '</div>';\n    peopleHtml += '</div></div>';\n  }\n  \n  peopleHtml += '</div>';\n  compIdx++;\n}\n\nconst html = `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\"/>\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/>\n  <title>People Selection - Enrichment</title>\n  <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n  <link href=\"https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n  <style>\n    :root{--bg:#f4f6fb;--card:#ffffff;--muted:#5f6b82;--text:#1a1d2e;--accent:#d48a2e;--accent-2:#2a8fa8;--border:#d8dde8;--chip:#eaecf3;--shadow:0 12px 30px rgba(0,0,0,.08);--green:#16a34a;--purple:#7c3aed;--gold:#d48a2e}\n    *{box-sizing:border-box;margin:0}\n    body{font-family:\"Space Grotesk\",\"Segoe UI\",sans-serif;background:radial-gradient(1200px 600px at 10% -20%,#dce6f0 0%,transparent 60%),radial-gradient(800px 500px at 90% -10%,#ece4f3 0%,transparent 60%),var(--bg);color:var(--text);min-height:100vh}\n    header{padding:28px 28px 12px;display:flex;align-items:flex-end;justify-content:space-between;gap:16px;flex-wrap:wrap}\n    h1{font-size:28px;letter-spacing:.2px}\n    .sub{color:var(--muted);font-size:14px;margin-top:6px}\n    .stats{display:flex;gap:12px;flex-wrap:wrap}\n    .chip{background:var(--chip);border:1px solid var(--border);border-radius:999px;padding:6px 14px;font-size:12px;color:var(--muted)}\n    .chip.highlight{border-color:var(--green);color:var(--green)}\n    .chip.ai{border-color:var(--purple);color:var(--purple)}\n    .chip.gold{border-color:var(--gold);color:var(--gold)}\n    .container{padding:0 24px 32px;display:grid;gap:16px}\n    .panel{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);padding:20px}\n    .toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;gap:12px;flex-wrap:wrap}\n    .toolbar-left{display:flex;align-items:center;gap:12px;flex-wrap:wrap}\n    input[type=\"text\"]{background:#f0f2f7;border:1px solid var(--border);border-radius:10px;padding:10px 14px;width:320px;max-width:100%;color:var(--text);outline:none;font:inherit;font-size:14px}\n    input[type=\"text\"]:focus{border-color:var(--accent-2)}\n    .btn{display:inline-flex;align-items:center;gap:6px;padding:10px 20px;border-radius:10px;font-weight:600;font-size:14px;cursor:pointer;transition:transform .15s,box-shadow .15s;text-decoration:none;border:none;font-family:inherit}\n    .btn:hover{transform:translateY(-1px)}\n    .btn-primary{background:linear-gradient(135deg,var(--accent),#e8b96a);color:#1b1b1b;box-shadow:0 4px 12px rgba(212,138,46,.25)}\n    .btn-secondary{background:rgba(42,143,168,.08);color:var(--accent-2);border:1px solid rgba(42,143,168,.2)}\n    .btn-back{background:rgba(124,58,237,.08);color:var(--purple);border:1px solid rgba(124,58,237,.2)}\n    .btn:disabled{opacity:.5;cursor:not-allowed;transform:none}\n    .company-section{margin-bottom:16px;border:1px solid var(--border);border-radius:12px;overflow:hidden;background:rgba(0,0,0,.02)}\n    .company-header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:rgba(124,58,237,.06);border-bottom:1px solid rgba(124,58,237,.15)}\n    .company-header-left{display:flex;align-items:center;gap:12px}\n    .company-name{font-weight:700;font-size:15px;color:var(--purple)}\n    .company-meta{color:var(--muted);font-size:12px;margin-top:3px}\n    .person-row{display:flex;align-items:flex-start;gap:12px;padding:12px 16px;border-bottom:1px solid var(--border);transition:background .15s}\n    .person-row:last-child{border-bottom:none}\n    .person-row:hover{background:rgba(0,0,0,.03)}\n    .person-row.suggested{background:rgba(212,138,46,.06);border-left:3px solid var(--gold)}\n    .person-info{flex:1;min-width:0}\n    .person-name-line{display:flex;align-items:center;gap:8px;flex-wrap:wrap}\n    .person-name{font-weight:600;font-size:14px}\n    .person-title{color:var(--accent);font-weight:500;font-size:13px;margin-top:2px}\n    .person-location{color:var(--muted);font-size:12px;margin-top:2px}\n    .sug-reason{color:var(--gold);font-size:12px;margin-top:4px;font-style:italic;padding:4px 8px;background:rgba(212,138,46,.06);border-radius:6px;border-left:2px solid var(--gold)}\n    .person-skills{margin-top:6px}\n    .skill{display:inline-block;padding:2px 7px;border-radius:6px;font-size:10px;background:rgba(42,143,168,.08);color:var(--accent-2);border:1px solid rgba(42,143,168,.15);margin:2px}\n    .person-exp{margin-top:4px}\n    .exp-item{font-size:11px;color:var(--muted);line-height:1.4;margin-bottom:2px}\n    .badge{display:inline-block;padding:3px 8px;border-radius:999px;font-size:11px;border:1px solid;font-weight:500}\n    .badge.otw{background:rgba(22,163,74,.1);color:var(--green);border-color:rgba(22,163,74,.25)}\n    .badge.ai-sug{background:rgba(212,138,46,.1);color:var(--gold);border-color:rgba(212,138,46,.25)}\n    .cb-wrap{position:relative;display:flex;align-items:center;cursor:pointer;padding-top:2px}\n    .cb-wrap input{position:absolute;opacity:0;cursor:pointer;height:0;width:0}\n    .checkmark{height:18px;width:18px;border:2px solid var(--border);border-radius:4px;transition:all .2s;flex-shrink:0}\n    .cb-wrap input:checked~.checkmark{background:var(--accent);border-color:var(--accent)}\n    .cb-wrap input:checked~.checkmark::after{content:'';position:absolute;left:5px;top:1px;width:5px;height:10px;border:solid #1b1b1b;border-width:0 2px 2px 0;transform:rotate(45deg)}\n    .select-bar{display:flex;align-items:center;gap:16px;padding:12px 16px;background:rgba(212,138,46,.06);border:1px solid rgba(212,138,46,.15);border-radius:10px;margin-bottom:16px}\n    .select-count{font-weight:600;color:var(--accent);font-size:14px}\n    #status-msg{margin-left:12px;font-size:13px;color:var(--green)}\n    @media(max-width:780px){header{flex-direction:column;align-items:flex-start}input[type=\"text\"]{width:100%}.toolbar{flex-direction:column;align-items:flex-start}}\n  </style>\n</head>\n<body>\n  <header>\n    <div>\n      <h1>People Found - Select for Enrichment</h1>\n      <div class=\"sub\">All people found via SignalHire. AI-suggested contacts are highlighted. Select people to enrich with full contact details.</div>\n    </div>\n    <div class=\"stats\">\n      <div class=\"chip\">${companiesSearched} companies</div>\n      <div class=\"chip highlight\">${totalPeople} people found</div>\n      <div class=\"chip gold\">${suggestedCount} AI suggested</div>\n      <div class=\"chip ai\">SignalHire + Claude AI</div>\n    </div>\n  </header>\n  <div class=\"container\">\n    <div class=\"panel\">\n      <div class=\"toolbar\">\n        <div class=\"toolbar-left\">\n          <input id=\"search\" type=\"text\" placeholder=\"Filter by name, title, company, skills...\"/>\n          <label class=\"cb-wrap\" style=\"gap:8px;font-size:13px;color:var(--muted)\">\n            <input type=\"checkbox\" id=\"global-select-all\"/>\n            <span class=\"checkmark\"></span>\n            Select All\n          </label>\n        </div>\n        <div style=\"display:flex;gap:10px;flex-wrap:wrap\">\n          <a class=\"btn btn-back\" href=\"/webhook/jobs-ui\">Back to Jobs</a>\n          <a class=\"btn btn-secondary\" href=\"/webhook/enriched-ui\">View Enriched Data</a>\n        </div>\n      </div>\n      <div class=\"select-bar\">\n        <span class=\"select-count\"><span id=\"sel-count\">0</span> people selected</span>\n        <button class=\"btn btn-primary\" id=\"enrich-btn\" disabled>Enrich Selected</button>\n        <span id=\"status-msg\"></span>\n      </div>\n      <input type=\"hidden\" id=\"batch-id\" value=\"${searchBatchId}\"/>\n      <div id=\"people-list\">\n        ${peopleHtml}\n      </div>\n    </div>\n  </div>\n  <script>\n    const allCbs = document.querySelectorAll('.person-cb');\n    const companyCbs = document.querySelectorAll('.company-select-all');\n    const globalCb = document.getElementById('global-select-all');\n    const enrichBtn = document.getElementById('enrich-btn');\n    const selCount = document.getElementById('sel-count');\n    const statusMsg = document.getElementById('status-msg');\n    const batchId = document.getElementById('batch-id').value;\n\n    function updateCount() {\n      const checked = document.querySelectorAll('.person-cb:checked').length;\n      selCount.textContent = checked;\n      enrichBtn.disabled = checked === 0;\n    }\n\n    allCbs.forEach(cb => cb.addEventListener('change', () => {\n      updateCount();\n      const comp = cb.dataset.company;\n      const compCbs = document.querySelectorAll('.person-cb[data-company=\"'+comp+'\"]');\n      const compAll = document.querySelector('.company-select-all[data-company=\"'+comp+'\"]');\n      if(compAll) compAll.checked = [...compCbs].every(c => c.checked);\n      globalCb.checked = [...allCbs].every(c => c.checked);\n    }));\n\n    companyCbs.forEach(cb => cb.addEventListener('change', () => {\n      const comp = cb.dataset.company;\n      const compCbs = document.querySelectorAll('.person-cb[data-company=\"'+comp+'\"]');\n      compCbs.forEach(c => c.checked = cb.checked);\n      updateCount();\n      globalCb.checked = [...allCbs].every(c => c.checked);\n    }));\n\n    globalCb.addEventListener('change', () => {\n      allCbs.forEach(c => c.checked = globalCb.checked);\n      companyCbs.forEach(c => c.checked = globalCb.checked);\n      updateCount();\n    });\n\n    document.getElementById('search').addEventListener('input', function() {\n      const q = this.value.toLowerCase();\n      document.querySelectorAll('.company-section').forEach(sec => {\n        const rows = sec.querySelectorAll('.person-row');\n        let anyVisible = false;\n        rows.forEach(r => {\n          const show = !q || r.textContent.toLowerCase().includes(q);\n          r.style.display = show ? '' : 'none';\n          if (show) anyVisible = true;\n        });\n        sec.style.display = (!q || anyVisible || sec.querySelector('.company-header').textContent.toLowerCase().includes(q)) ? '' : 'none';\n      });\n    });\n\n    enrichBtn.addEventListener('click', async () => {\n      const selected = [...document.querySelectorAll('.person-cb:checked')].map(c => c.dataset.uid).filter(Boolean);\n      if (selected.length === 0) return;\n      enrichBtn.disabled = true;\n      enrichBtn.textContent = 'Enriching...';\n      statusMsg.textContent = 'Sending ' + selected.length + ' people for enrichment...';\n      try {\n        const resp = await fetch('/webhook/enrich-submit', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ uids: selected, searchBatchId: batchId })\n        });\n        const result = await resp.text();\n        statusMsg.textContent = 'Enrichment request sent! Check back at View Enriched Data for results.';\n        statusMsg.style.color = 'var(--green)';\n        enrichBtn.textContent = 'Sent!';\n      } catch(e) {\n        statusMsg.textContent = 'Error: ' + e.message;\n        statusMsg.style.color = '#f87171';\n        enrichBtn.disabled = false;\n        enrichBtn.textContent = 'Enrich Selected';\n      }\n    });\n  </script>\n</body>\n</html>`;\n\nreturn [{ json: { html, allPeople, searchBatchId, companiesSearched, totalPeople } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2336,
        1488
      ],
      "id": "b7fe0948-0e14-4ec3-8ded-4e97e246d1d0",
      "name": "Build Leaders UI HTML"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all().map(i => i.json);\n\n// Group jobs by company\nconst companyMap = {};\nfor (const job of items) {\n  const name = (job.employer_name || '').trim();\n  if (!name) continue;\n  if (!companyMap[name]) companyMap[name] = [];\n  companyMap[name].push({\n    title: job.job_title || '',\n    location: job.job_location || '',\n    type: job.job_employment_type || '',\n    remote: job.job_is_remote ? 'Yes' : 'No'\n  });\n}\n\nconst companies = Object.keys(companyMap);\nif (companies.length === 0) {\n  return [{ json: { error: 'No companies found in selection' } }];\n}\n\n// Output one item per company for SignalHire search\nreturn companies.map(name => ({\n  json: {\n    companyName: name,\n    jobs: companyMap[name],\n    companiesTotal: companies.length\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        608,
        1488
      ],
      "id": "5f7927ff-fc4c-4353-b3f3-8628b6f7b827",
      "name": "Prepare Company Search"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://www.signalhire.com/api/v1/candidate/searchByQuery",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $env.SIGNALHIRE_API_KEY }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"currentCompany\": {{ JSON.stringify($json.companyName) }},\n  \"currentTitle\": \"VP OR Director OR Head OR Chief OR President OR SVP OR Partner OR Founder\",\n  \"size\": 15\n}",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        848,
        1488
      ],
      "id": "aff87e48-cb41-4abd-8057-a4cc029026d4",
      "name": "Search SignalHire Leaders",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const shItems = $input.all();\nconst companyItems = $items('Prepare Company Search');\n\n// Collect all profiles per company\nconst companyData = [];\nfor (let i = 0; i < shItems.length; i++) {\n  const sh = shItems[i].json;\n  const ci = companyItems[i] ? companyItems[i].json : {};\n  const companyName = ci.companyName || 'Unknown';\n  const jobs = ci.jobs || [];\n  const profiles = sh.profiles || [];\n  \n  companyData.push({\n    companyName,\n    jobs,\n    profiles: profiles.map(p => ({\n      fullName: p.fullName || '',\n      location: p.location || '',\n      currentTitle: (p.experience && p.experience[0]) ? p.experience[0].title : '',\n      currentCompany: (p.experience && p.experience[0]) ? p.experience[0].company : '',\n      experience: (p.experience || []).slice(0, 4).map(e => e.title + ' at ' + e.company),\n      skills: (p.skills || []).slice(0, 8),\n      openToWork: p.openToWork || false,\n      uid: p.uid || ''\n    })),\n    totalFound: sh.total || 0\n  });\n}\n\n// Build prompt for Claude to pick best 3 per company\nlet promptText = 'You are a GTM sales intelligence assistant. Below are real people found at each company via SignalHire. For each company, analyze the people and pick EXACTLY 3 who are the best decision-makers to contact for a sales outreach related to the job postings shown.\\n\\nConsider:\\n- Seniority and relevance of their role\\n- How their department relates to the job posting\\n- Their experience and skills\\n\\nReturn ONLY valid JSON in this format:\\n{\\n  \"picks\": [\\n    {\\n      \"company\": \"Company Name\",\\n      \"selected\": [\\n        { \"fullName\": \"exact name from the list\", \"reason\": \"one sentence why\" }\\n      ]\\n    }\\n  ]\\n}\\n\\n';\n\nfor (const cd of companyData) {\n  promptText += '\\n--- COMPANY: ' + cd.companyName + ' ---\\n';\n  promptText += 'Job postings: ' + cd.jobs.map(j => j.title + ' (' + j.location + ')').join(', ') + '\\n';\n  promptText += 'People found (' + cd.profiles.length + '):\\n';\n  for (const p of cd.profiles) {\n    promptText += '  â€¢ ' + p.fullName + ' | ' + p.currentTitle + ' | ' + p.location + ' | Skills: ' + p.skills.slice(0, 5).join(', ') + '\\n';\n  }\n  if (cd.profiles.length === 0) {\n    promptText += '  (No senior leaders found)\\n';\n  }\n}\n\nreturn [{ json: {\n  prompt: promptText,\n  companyData: companyData,\n  companiesTotal: companyData.length\n} }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1088,
        1488
      ],
      "id": "64f7104b-2af2-4813-96a3-d392622c5277",
      "name": "Prepare AI Analysis"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.anthropic.com/v1/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "={{ $env.ANTHROPIC_API_KEY }}"
            },
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"claude-3-5-haiku-20241022\",\n  \"max_tokens\": 1024,\n  \"messages\": [{\"role\": \"user\", \"content\": {{ JSON.stringify($json.prompt) }} }]\n}",
        "options": {
          "timeout": 60000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1328,
        1488
      ],
      "id": "61e8c7de-5aa8-46e5-8bc8-7445860b6bc5",
      "name": "Claude Pick Best Leaders",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const claudeResp = $input.all()[0].json;\nconst analysisData = $items('Prepare AI Analysis')[0].json;\nconst companyData = analysisData.companyData || [];\nconst companiesTotal = analysisData.companiesTotal || 0;\n\n// Parse Claude response\nlet text = '';\nif (claudeResp.content && Array.isArray(claudeResp.content) && claudeResp.content[0]) {\n  text = claudeResp.content[0].text || '';\n}\n\nlet aiPicks;\ntry {\n  aiPicks = JSON.parse(text);\n} catch(e) {\n  const m = text.match(/\\{[\\s\\S]*\\}/);\n  if (m) { try { aiPicks = JSON.parse(m[0]); } catch(e2) {} }\n}\n\nconst searchBatchId = 'batch_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);\nconst allPeople = [];\n\n// Build a map of AI picks per company\nconst picksMap = {};\nif (aiPicks && aiPicks.picks) {\n  for (const pick of aiPicks.picks) {\n    const compName = (pick.company || '').toLowerCase();\n    picksMap[compName] = {};\n    for (const sel of (pick.selected || [])) {\n      picksMap[compName][(sel.fullName || '').toLowerCase()] = sel.reason || '';\n    }\n  }\n}\n\n// Process ALL profiles from ALL companies\nfor (const cd of companyData) {\n  const companyName = cd.companyName || 'Unknown';\n  const sourceJob = cd.jobs && cd.jobs[0] ? cd.jobs[0] : {};\n  const compKey = companyName.toLowerCase();\n  const compPicks = picksMap[compKey] || {};\n  \n  // Also try partial matching for company names\n  let matchedPicks = compPicks;\n  if (Object.keys(compPicks).length === 0) {\n    for (const pk of Object.keys(picksMap)) {\n      if (compKey.includes(pk) || pk.includes(compKey)) {\n        matchedPicks = picksMap[pk];\n        break;\n      }\n    }\n  }\n  \n  for (const profile of (cd.profiles || [])) {\n    const nameKey = (profile.fullName || '').toLowerCase();\n    const isSuggested = nameKey in matchedPicks;\n    const reason = matchedPicks[nameKey] || '';\n    \n    allPeople.push({\n      company: companyName,\n      fullName: profile.fullName || 'Unknown',\n      currentTitle: profile.currentTitle || 'N/A',\n      location: profile.location || 'N/A',\n      skills: profile.skills || [],\n      experience: profile.experience || [],\n      openToWork: profile.openToWork || false,\n      uid: profile.uid || '',\n      is_suggested: isSuggested,\n      suggestion_reason: reason,\n      sourceJobTitle: sourceJob.title || '',\n      sourceJobLocation: sourceJob.location || ''\n    });\n  }\n}\n\nreturn [{ json: {\n  allPeople,\n  companiesSearched: companiesTotal,\n  totalPeople: allPeople.length,\n  searchBatchId\n}}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1536,
        1488
      ],
      "id": "d69842db-31ad-416f-9270-09c4a47132af",
      "name": "Process AI Picks"
    },
    {
      "parameters": {
        "jsCode": "const data = $json;\nconst allPeople = data.allPeople || [];\nconst batchId = data.searchBatchId || '';\n\nif (allPeople.length === 0) {\n  return [{ json: { ...data, sqlStatements: [], error: 'No people to save' } }];\n}\n\nconst createTableSQL = `CREATE TABLE IF NOT EXISTS people (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  uid VARCHAR(64) NOT NULL,\n  company_name VARCHAR(255),\n  full_name VARCHAR(255),\n  current_title VARCHAR(500),\n  location VARCHAR(255),\n  skills TEXT,\n  experience TEXT,\n  open_to_work TINYINT DEFAULT 0,\n  is_suggested TINYINT DEFAULT 0,\n  suggestion_reason TEXT,\n  source_job_title VARCHAR(500),\n  source_job_location VARCHAR(255),\n  search_batch_id VARCHAR(64),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE KEY unique_uid (uid)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4`;\n\nconst esc = (s) => String(s || '').replace(/\\\\/g, '\\\\\\\\').replace(/'/g, \"\\\\'\");\n\nconst values = allPeople.map(p => {\n  return `('${esc(p.uid)}', '${esc(p.company)}', '${esc(p.fullName)}', '${esc(p.currentTitle)}', '${esc(p.location)}', '${esc(JSON.stringify(p.skills))}', '${esc(JSON.stringify(p.experience))}', ${p.openToWork ? 1 : 0}, ${p.is_suggested ? 1 : 0}, '${esc(p.suggestion_reason)}', '${esc(p.sourceJobTitle)}', '${esc(p.sourceJobLocation)}', '${esc(batchId)}')`;\n}).join(',\\n');\n\nconst insertSQL = `INSERT INTO people (uid, company_name, full_name, current_title, location, skills, experience, open_to_work, is_suggested, suggestion_reason, source_job_title, source_job_location, search_batch_id)\nVALUES ${values}\nON DUPLICATE KEY UPDATE\n  company_name = VALUES(company_name),\n  full_name = VALUES(full_name),\n  current_title = VALUES(current_title),\n  location = VALUES(location),\n  skills = VALUES(skills),\n  experience = VALUES(experience),\n  open_to_work = VALUES(open_to_work),\n  is_suggested = VALUES(is_suggested),\n  suggestion_reason = VALUES(suggestion_reason),\n  source_job_title = VALUES(source_job_title),\n  source_job_location = VALUES(source_job_location),\n  search_batch_id = VALUES(search_batch_id)`;\n\nreturn [{ json: { ...data, createTableSQL, insertSQL } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1728,
        1488
      ],
      "id": "23d9d659-4747-4303-be4f-980816ccb795",
      "name": "Save People to DB"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "={{$json.createTableSQL}}",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2,
      "position": [
        1936,
        1392
      ],
      "id": "52118c6f-7b55-4dd4-9492-ad8b7c6b4b4b",
      "name": "Create People Table (MySQL)",
      "credentials": {
        "mySql": {
          "id": "Mmz0SsGmSZ76dUMn",
          "name": "MySQL account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "={{$items('Save People to DB')[0].json.insertSQL}}",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2,
      "position": [
        2128,
        1392
      ],
      "id": "6acf5bf2-09c3-444f-8edc-e3671a903712",
      "name": "Insert People (MySQL)",
      "credentials": {
        "mySql": {
          "id": "Mmz0SsGmSZ76dUMn",
          "name": "MySQL account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "CREATE TABLE IF NOT EXISTS enriched_people (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  uid VARCHAR(64) NOT NULL,\n  full_name VARCHAR(255),\n  company_name VARCHAR(255),\n  headline VARCHAR(500),\n  summary TEXT,\n  photo_url VARCHAR(500),\n  location_name VARCHAR(255),\n  emails TEXT,\n  phones TEXT,\n  social_links TEXT,\n  education TEXT,\n  experience_detailed TEXT,\n  languages TEXT,\n  certifications TEXT,\n  skills TEXT,\n  open_to_work TINYINT DEFAULT 0,\n  enrichment_status VARCHAR(50) DEFAULT 'pending',\n  search_batch_id VARCHAR(64),\n  enriched_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE KEY unique_uid (uid)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2,
      "position": [
        2128,
        1600
      ],
      "id": "13cbac43-1596-4b7f-b51d-1d8686bcf5bc",
      "name": "Create Enriched Table (MySQL)",
      "credentials": {
        "mySql": {
          "id": "Mmz0SsGmSZ76dUMn",
          "name": "MySQL account 2"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "enrich-submit",
        "responseMode": "responseNode",
        "options": {},
        "authentication": "headerAuth"
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        608,
        2064
      ],
      "id": "0de8a0ed-8cb6-46a2-9146-7dfa211e68a3",
      "name": "Enrich Submit (POST)",
      "webhookId": "f1a2b3c4-d5e6-7890-abcd-enrichsubmit",
      "credentials": {
        "httpHeaderAuth": {
          "id": "WEBHOOK_AUTH_CRED_ID",
          "name": "Webhook Auth Header"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const payload = $json.body || $json;\nconst uids = payload.uids || [];\nconst searchBatchId = payload.searchBatchId || '';\n\n// Input validation: limit UIDs to 50 max, validate format\nif (!Array.isArray(uids) || uids.length === 0) {\n  return [{ json: { error: 'No UIDs provided', uids: [], searchBatchId } }];\n}\n\n// Production callback URL using Render-hosted n8n instance.\n// No ngrok needed â€” SignalHire calls back directly to the public Render URL.\nconst callbackUrl = 'https://n8n-combined.onrender.com/webhook/signalhire-callback';\n\n// Validate UIDs: alphanumeric only, max 50\nconst safeUids = uids\n  .map(u => String(u).trim())\n  .filter(u => u.length > 0 && u.length <= 128 && /^[a-zA-Z0-9_\\-]+$/.test(u))\n  .slice(0, 50);\n\nif (safeUids.length === 0) {\n  return [{ json: { error: 'No valid UIDs after validation', uids: [], searchBatchId } }];\n}\n\nreturn [{ json: {\n  items: safeUids,\n  callbackUrl: callbackUrl,\n  searchBatchId: searchBatchId,\n  totalRequested: uids.length\n} }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        848,
        2064
      ],
      "id": "622775ef-4a49-4b21-b822-5191d6a28b94",
      "name": "Process Enrich Request"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://www.signalhire.com/api/v1/candidate/search",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $env.SIGNALHIRE_API_KEY }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"items\": {{ JSON.stringify($json.items) }},\n  \"callbackUrl\": {{ JSON.stringify($json.callbackUrl) }}\n}",
        "options": {
          "timeout": 60000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1088,
        2064
      ],
      "id": "503261a5-4127-4b92-a11a-05d185b9b67d",
      "name": "Call SignalHire Person API",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={\"status\":\"ok\",\"message\":\"Enrichment request sent. Results will arrive via callback.\"}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json; charset=UTF-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        1328,
        2064
      ],
      "id": "b67cd392-59f2-4e01-8993-7bb175484171",
      "name": "Enrich Response"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "signalhire-callback",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        608,
        2368
      ],
      "id": "93eb1ef7-d8d8-4f02-9bd8-f29e4b8a5ffb",
      "name": "SignalHire Callback (POST)",
      "webhookId": "f1a2b3c4-d5e6-7890-abcd-shcallback01",
      "notes": "SECURITY: This webhook is called by SignalHire servers. Consider adding IP allowlist or shared secret validation in the processing node."
    },
    {
      "parameters": {
        "jsCode": "const callbackData = $json.body || $json;\nconst items = Array.isArray(callbackData) ? callbackData : (callbackData.items || callbackData.data || [callbackData]);\n\nif (!items || items.length === 0) {\n  return [{ json: { error: 'No callback data received', insertSQL: 'SELECT 1' } }];\n}\n\nconst esc = (s) => String(s || '').replace(/\\\\/g, '\\\\\\\\').replace(/'/g, \"\\\\'\");\nconst jsonEsc = (v) => esc(JSON.stringify(v || []));\n\nconst successItems = items.filter(i => i.status === 'success' && i.candidate);\n\nif (successItems.length === 0) {\n  const failInfo = items.map(i => i.status + ': ' + (i.item || '')).join(', ');\n  return [{ json: { error: 'No successful enrichments. Statuses: ' + failInfo, insertSQL: 'SELECT 1', totalProcessed: 0 } }];\n}\n\nconst values = successItems.map(item => {\n  const c = item.candidate;\n  \n  const emails = (c.contacts || []).filter(ct => ct.type === 'email').map(ct => ({\n    value: ct.value || '', subType: ct.subType || 'unknown', rating: ct.rating || '0'\n  }));\n  \n  const phones = (c.contacts || []).filter(ct => ct.type === 'phone').map(ct => ({\n    value: ct.value || '', subType: ct.subType || 'unknown', rating: ct.rating || '0'\n  }));\n  \n  const socialLinks = (c.social || []).map(s => ({\n    type: s.type || '', link: s.link || '', rating: s.rating || '0'\n  }));\n  \n  const education = (c.education || []).map(ed => ({\n    university: ed.university || '', faculty: ed.faculty || '',\n    degree: Array.isArray(ed.degree) ? ed.degree.join(', ') : (ed.degree || ''),\n    startedYear: ed.startedYear || '', endedYear: ed.endedYear || ''\n  }));\n  \n  const experience = (c.experience || []).map(exp => ({\n    position: exp.position || '', company: exp.company || '',\n    location: exp.location || '', current: exp.current || false,\n    started: exp.started || '', ended: exp.ended || '',\n    summary: exp.summary || '', companySize: exp.companySize || '',\n    staffCount: exp.staffCount || 0, industry: exp.industry || '',\n    website: exp.website || ''\n  }));\n  \n  const languages = (c.language || []).map(l => ({\n    name: l.name || '', proficiency: l.proficiency || ''\n  }));\n  \n  const certifications = (c.certification || []).map(ct => ({\n    name: ct.name || '', authority: ct.authority || '', license: ct.license || ''\n  }));\n  \n  const loc = (c.locations || [])[0] || {};\n  const currentExp = (c.experience || []).find(e => e.current) || (c.experience || [])[0] || {};\n  const companyName = currentExp.company || '';\n  \n  return \"  ('\" + esc(c.uid || '') + \"', '\" + esc(c.fullName || '') + \"', '\" + esc(companyName) + \"', '\" + esc(c.headLine || '') + \"', '\" + esc(c.summary || '') + \"', '\" + esc(c.photo ? c.photo.url : '') + \"', '\" + esc(loc.name || '') + \"', '\" + jsonEsc(emails) + \"', '\" + jsonEsc(phones) + \"', '\" + jsonEsc(socialLinks) + \"', '\" + jsonEsc(education) + \"', '\" + jsonEsc(experience) + \"', '\" + jsonEsc(languages) + \"', '\" + jsonEsc(certifications) + \"', '\" + jsonEsc(c.skills || []) + \"', \" + (c.openToWork ? 1 : 0) + \", 'success', '')\";\n}).join(',\\n');\n\nconst insertSQL = \"INSERT INTO enriched_people (uid, full_name, company_name, headline, summary, photo_url, location_name, emails, phones, social_links, education, experience_detailed, languages, certifications, skills, open_to_work, enrichment_status, search_batch_id) VALUES\\n\" + values + \"\\nON DUPLICATE KEY UPDATE full_name=VALUES(full_name), company_name=VALUES(company_name), headline=VALUES(headline), summary=VALUES(summary), photo_url=VALUES(photo_url), location_name=VALUES(location_name), emails=VALUES(emails), phones=VALUES(phones), social_links=VALUES(social_links), education=VALUES(education), experience_detailed=VALUES(experience_detailed), languages=VALUES(languages), certifications=VALUES(certifications), skills=VALUES(skills), enrichment_status=VALUES(enrichment_status), enriched_at=CURRENT_TIMESTAMP\";\n\nreturn [{ json: { insertSQL, totalProcessed: successItems.length, failedItems: items.filter(i => i.status !== 'success').map(i => ({ item: i.item, status: i.status })) } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        848,
        2368
      ],
      "id": "e6c2da84-028b-432f-9513-eaf777a6a6bd",
      "name": "Process Callback Data"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "={{$json.insertSQL}}",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2,
      "position": [
        1088,
        2368
      ],
      "id": "3ad11379-e22d-42a6-9a55-25e2c9708b65",
      "name": "Save Enriched Data (MySQL)",
      "credentials": {
        "mySql": {
          "id": "Mmz0SsGmSZ76dUMn",
          "name": "MySQL account 2"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={\"status\":\"ok\",\"processed\":{{$json.totalProcessed}}}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json; charset=UTF-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        1328,
        2368
      ],
      "id": "ff73d046-94c2-4e03-85dd-9f47ebd8128e",
      "name": "Callback Response"
    },
    {
      "parameters": {
        "path": "enriched-ui",
        "responseMode": "responseNode",
        "options": {},
        "authentication": "headerAuth"
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        608,
        2656
      ],
      "id": "b373ecb1-d1d0-4a9f-a249-3f77bb636839",
      "name": "Enriched Data UI (GET)",
      "webhookId": "f1a2b3c4-d5e6-7890-abcd-enrichedui01",
      "credentials": {
        "httpHeaderAuth": {
          "id": "WEBHOOK_AUTH_CRED_ID",
          "name": "Webhook Auth Header"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n  e.*,\n  COALESCE(NULLIF(e.company_name, ''), p.company_name, 'Unknown Company') as display_company\nFROM enriched_people e\nLEFT JOIN people p ON e.uid = p.uid\nORDER BY e.enriched_at DESC\nLIMIT 200",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2,
      "position": [
        848,
        2656
      ],
      "id": "ac99d73c-a701-41ae-a9ce-1d53e5961bee",
      "name": "Fetch Enriched Data (MySQL)",
      "credentials": {
        "mySql": {
          "id": "Mmz0SsGmSZ76dUMn",
          "name": "MySQL account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $('Fetch Enriched Data (MySQL)').all().map(i => i.json);\n\n// Get Reply.io campaigns from direct input (fetched server-side)\nconst replyioRaw = $input.all().map(i => i.json).flat();\nconst sequencesArr = (Array.isArray(replyioRaw) ? replyioRaw : []).filter(c => c && c.id).map(c => ({ id: c.id, name: c.name || ('Sequence ' + c.id) }));\nconst sequencesJson = JSON.stringify(sequencesArr);\n\nconst esc = (s) => String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\"/g,'&quot;');\n\nconst tryParse = (v) => {\n  if (!v) return [];\n  if (Array.isArray(v)) return v;\n  if (typeof v === 'object' && v !== null) return Array.isArray(v) ? v : [v];\n  try { const parsed = JSON.parse(v); return Array.isArray(parsed) ? parsed : [parsed]; } catch(e) { return []; }\n};\n\n// Filter out rows that have no real data (empty MySQL results produce one row with nulls)\nconst realItems = items.filter(p => p.uid && p.uid !== '' && p.uid !== null);\n\n// --- Session detection: split into current session vs previous ---\n// Current session = enrichments within 30 minutes of the most recent enriched_at\nlet currentSessionItems = [];\nlet previousItems = [];\nif (realItems.length > 0) {\n  const SESSION_GAP_MS = 30 * 60 * 1000; // 30 minutes\n  // Find the latest enriched_at timestamp\n  let latestTs = 0;\n  for (const p of realItems) {\n    if (p.enriched_at) {\n      const ts = new Date(p.enriched_at).getTime();\n      if (ts > latestTs) latestTs = ts;\n    }\n  }\n  if (latestTs > 0) {\n    const cutoff = latestTs - SESSION_GAP_MS;\n    for (const p of realItems) {\n      const ts = p.enriched_at ? new Date(p.enriched_at).getTime() : 0;\n      if (ts >= cutoff) {\n        currentSessionItems.push(p);\n      } else {\n        previousItems.push(p);\n      }\n    }\n  } else {\n    // No timestamps available, treat all as current\n    currentSessionItems = realItems.slice();\n  }\n} \n\nconst totalPeople = realItems.length;\nconst currentCount = currentSessionItems.length;\nconst previousCount = previousItems.length;\n\n// Helper to group items by company\nfunction groupByCompany(arr) {\n  const grouped = {};\n  for (const p of arr) {\n    const company = p.display_company || p.company_name || 'Unknown Company';\n    if (!grouped[company]) grouped[company] = [];\n    grouped[company].push(p);\n  }\n  return grouped;\n}\n\n// Helper to build person card HTML\nfunction buildPersonCard(p) {\n  const emails = tryParse(p.emails);\n  const phones = tryParse(p.phones);\n  const socialLinks = tryParse(p.social_links);\n  const education = tryParse(p.education);\n  const experience = tryParse(p.experience_detailed);\n  const languages = tryParse(p.languages);\n  const certifications = tryParse(p.certifications);\n  const skills = tryParse(p.skills);\n  \n  const statusClass = p.enrichment_status === 'success' ? 'status-success' : (p.enrichment_status === 'failed' ? 'status-failed' : 'status-pending');\n  \n  let emailsHtml = '';\n  if (emails.length > 0) {\n    emailsHtml = emails.map(e => '<div class=\"contact-item\"><span class=\"contact-badge\">' + esc(e.subType || e.type || 'email') + '</span><a href=\"mailto:' + esc(e.value) + '\" class=\"contact-value\">' + esc(e.value) + '</a>' + (e.rating && e.rating !== '0' ? '<span class=\"rating\">&#9733; ' + e.rating + '%</span>' : '') + '</div>').join('');\n  } else {\n    emailsHtml = '<div class=\"no-data\">No emails found</div>';\n  }\n  \n  let phonesHtml = '';\n  if (phones.length > 0) {\n    phonesHtml = phones.map(ph => '<div class=\"contact-item\"><span class=\"contact-badge\">' + esc(ph.subType || ph.type || 'phone') + '</span><a href=\"tel:' + esc(ph.value) + '\" class=\"contact-value\">' + esc(ph.value) + '</a>' + (ph.rating && ph.rating !== '0' ? '<span class=\"rating\">&#9733; ' + ph.rating + '%</span>' : '') + '</div>').join('');\n  } else {\n    phonesHtml = '<div class=\"no-data\">No phone numbers found</div>';\n  }\n  \n  let socialHtml = '';\n  if (Array.isArray(socialLinks) && socialLinks.length > 0) {\n    socialHtml = socialLinks.map(s => {\n      const label = s.type === 'li' ? 'LinkedIn' : (s.type === 'fb' ? 'Facebook' : (s.type === 'tw' ? 'Twitter' : s.type));\n      return '<a class=\"social-link\" href=\"' + esc(s.link) + '\" target=\"_blank\">' + esc(label) + '</a>';\n    }).join(' ');\n  }\n  \n  let eduHtml = '';\n  if (education.length > 0) {\n    eduHtml = education.map(ed => '<div class=\"edu-item\"><strong>' + esc(ed.university || ed.school || '') + '</strong>' + (ed.degree ? ' - ' + esc(ed.degree) : '') + (ed.faculty ? ' (' + esc(ed.faculty) + ')' : '') + (ed.startedYear || ed.endedYear ? '<span class=\"date-range\"> ' + (ed.startedYear || '?') + ' - ' + (ed.endedYear || 'Present') + '</span>' : '') + '</div>').join('');\n  }\n  \n  let expHtml = '';\n  if (experience.length > 0) {\n    expHtml = experience.slice(0, 5).map(exp => {\n      let dateStr = '';\n      if (exp.started) {\n        const start = exp.started.substring(0, 7);\n        const end = exp.current ? 'Present' : (exp.ended ? exp.ended.substring(0, 7) : '');\n        dateStr = ' (' + start + (end ? ' - ' + end : '') + ')';\n      }\n      return '<div class=\"exp-item\"><div class=\"exp-title\">' + esc(exp.position || '') + '</div><div class=\"exp-company\">' + esc(exp.company || '') + dateStr + '</div>' + (exp.industry ? '<span class=\"exp-tag\">' + esc(exp.industry) + '</span>' : '') + (exp.companySize ? '<span class=\"exp-tag\">' + esc(exp.companySize) + ' employees</span>' : '') + (exp.summary ? '<div class=\"exp-summary\">' + esc(exp.summary).substring(0, 200) + '</div>' : '') + '</div>';\n    }).join('');\n  }\n  \n  let skillsHtml = '';\n  if (Array.isArray(skills) && skills.length > 0) {\n    skillsHtml = skills.slice(0, 12).map(s => '<span class=\"skill-chip\">' + esc(typeof s === 'string' ? s : s.name || '') + '</span>').join('');\n  }\n  \n  let langHtml = '';\n  if (languages.length > 0) {\n    langHtml = languages.map(l => '<span class=\"lang-chip\">' + esc(l.name || '') + (l.proficiency ? ' (' + esc(l.proficiency) + ')' : '') + '</span>').join(' ');\n  }\n  \n  let certHtml = '';\n  if (certifications.length > 0) {\n    certHtml = certifications.map(ct => '<div class=\"cert-item\">' + esc(ct.name || '') + (ct.authority ? ' - ' + esc(ct.authority) : '') + '</div>').join('');\n  }\n  \n  const photoHtml = p.photo_url ? '<img src=\"' + esc(p.photo_url) + '\" class=\"person-photo\" onerror=\"this.style.display=\\'none\\';this.nextElementSibling.style.display=\\'flex\\'\"/><div class=\"photo-placeholder\" style=\"display:none\">&#128100;</div>' : '<div class=\"photo-placeholder\">&#128100;</div>';\n  \n  let card = '<div class=\"person-card\" data-uid=\"' + esc(p.uid) + '\">';\n  card += '<div class=\"card-inner\">';\n  card += '<input type=\"checkbox\" class=\"person-cb\" data-uid=\"' + esc(p.uid) + '\" onchange=\"updateSelCount()\" />';\n  card += '<div class=\"card-content\">';\n  card += '<div class=\"person-header\">';\n  card += '<div class=\"person-photo-wrap\">' + photoHtml + '</div>';\n  card += '<div class=\"person-info\"><h3>' + esc(p.full_name || 'Unknown') + '</h3>';\n  if (p.headline) card += '<div class=\"person-headline\">' + esc(p.headline) + '</div>';\n  if (p.location_name) card += '<div class=\"person-location\">&#128205; ' + esc(p.location_name) + '</div>';\n  card += '<span class=\"status-badge ' + statusClass + '\">' + esc(p.enrichment_status || 'unknown') + '</span>';\n  card += '</div></div>';\n  \n  if (p.summary) {\n    card += '<div class=\"person-summary\">' + esc(p.summary).substring(0, 400) + '</div>';\n  }\n  \n  card += '<div class=\"section\"><div class=\"section-title\">&#9993; Contact</div>';\n  card += '<div class=\"subsection\"><strong>Emails</strong>' + emailsHtml + '</div>';\n  card += '<div class=\"subsection\"><strong>Phones</strong>' + phonesHtml + '</div>';\n  if (socialHtml) card += '<div class=\"subsection\"><strong>Social</strong><div class=\"social-links\">' + socialHtml + '</div></div>';\n  card += '</div>';\n  \n  if (skillsHtml) {\n    card += '<div class=\"section\"><div class=\"section-title\">&#127919; Skills</div><div class=\"skills-wrap\">' + skillsHtml + '</div></div>';\n  }\n  \n  if (expHtml) {\n    card += '<div class=\"section\"><div class=\"section-title\">&#128188; Experience</div>' + expHtml + '</div>';\n  }\n  \n  if (eduHtml) {\n    card += '<div class=\"section\"><div class=\"section-title\">&#127891; Education</div>' + eduHtml + '</div>';\n  }\n  \n  if (langHtml) {\n    card += '<div class=\"section\"><div class=\"section-title\">&#127760; Languages</div><div class=\"lang-wrap\">' + langHtml + '</div></div>';\n  }\n  \n  if (certHtml) {\n    card += '<div class=\"section\"><div class=\"section-title\">&#127942; Certifications</div>' + certHtml + '</div>';\n  }\n  \n  card += '</div></div>'; // card-content + card-inner\n  card += '</div>'; // person-card\n  return card;\n}\n\n// Helper to build grouped cards HTML\nfunction buildGroupedCards(arr) {\n  const grouped = groupByCompany(arr);\n  const companies = Object.keys(grouped);\n  let html = '';\n  for (const company of companies) {\n    const people = grouped[company];\n    html += '<div class=\"company-group\">';\n    html += '<div class=\"company-group-header\">' + esc(company) + ' (' + people.length + ' people)</div>';\n    for (const p of people) {\n      html += buildPersonCard(p);\n    }\n    html += '</div>';\n  }\n  return html;\n}\n\n// Build current session cards\nlet currentCardsHtml = '';\nlet previousCardsHtml = '';\nlet emptyHtml = '';\n\nif (totalPeople === 0) {\n  emptyHtml = '<div class=\"empty-state\"><div class=\"empty-icon\">&#128269;</div><h3>No enriched data yet</h3><p>Select people from the Leaders page and click \\\"Enrich Selected\\\" to fetch their contact details via SignalHire Person API.</p><p class=\"note\">Note: The Person API uses a callback mechanism. After you submit enrichment requests, SignalHire processes them asynchronously and sends results back to your callback webhook. This may take a few seconds to a few minutes.</p></div>';\n} else {\n  if (currentCount > 0) {\n    currentCardsHtml = buildGroupedCards(currentSessionItems);\n  } else {\n    currentCardsHtml = '<div class=\"empty-state\" style=\"padding:30px 20px\"><div class=\"empty-icon\">&#9989;</div><h3>No current session enrichments</h3><p>All enriched people are from previous sessions. Tick the checkbox above to view them.</p></div>';\n  }\n  if (previousCount > 0) {\n    previousCardsHtml = buildGroupedCards(previousItems);\n  }\n}\n\nconst currentCompanies = Object.keys(groupByCompany(currentSessionItems));\nconst previousCompanies = Object.keys(groupByCompany(previousItems));\n\nconst peopleDataJson = JSON.stringify(realItems.map(p => ({\n  uid: p.uid,\n  full_name: p.full_name || '',\n  display_company: p.display_company || p.company_name || '',\n  headline: p.headline || '',\n  summary: (p.summary || '').substring(0, 300),\n  location_name: p.location_name || '',\n  emails: tryParse(p.emails),\n  phones: tryParse(p.phones),\n  social_links: tryParse(p.social_links),\n  experience_detailed: tryParse(p.experience_detailed),\n  skills: tryParse(p.skills)\n}))).split('</' + 'script').join('<\\\\/' + 'script');\n\nconst html = `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n  <title>Enriched People Data</title>\n  <style>\n    :root { --bg: #f4f6fb; --card: #ffffff; --muted: #5f6b82; --text: #1a1d2e; --accent: #d48a2e; --accent-2: #2a8fa8; --green: #16a34a; --red: #dc2626; --border: #d8dde8; --chip: #eaecf3; }\n    * { box-sizing: border-box; margin: 0; }\n    body { font-family: \"Space Grotesk\",\"Satoshi\",\"Segoe UI\",sans-serif; background: radial-gradient(1200px 600px at 10% -20%,#dce6f0 0%,transparent 60%),radial-gradient(800px 500px at 90% -10%,#f0e8e8 0%,transparent 60%),var(--bg); color: var(--text); min-height: 100vh; }\n    header { padding: 28px 28px 12px; display: flex; align-items: flex-end; justify-content: space-between; gap: 16px; flex-wrap: wrap; }\n    h1 { font-size: 28px; letter-spacing: 0.2px; }\n    .sub { color: var(--muted); font-size: 14px; margin-top: 6px; }\n    .stats { display: flex; gap: 12px; flex-wrap: wrap; }\n    .chip { background: var(--chip); border: 1px solid var(--border); border-radius: 999px; padding: 6px 14px; font-size: 13px; color: var(--muted); }\n    .chip.accent { border-color: var(--accent); color: var(--accent); }\n    .container { padding: 12px 24px 40px; }\n    .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 12px; flex-wrap: wrap; }\n    .toolbar input { background: var(--card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); padding: 10px 16px; font-size: 14px; width: 340px; outline: none; }\n    .toolbar input:focus { border-color: var(--accent-2); }\n    .btn { background: var(--card); border: 1px solid var(--border); border-radius: 8px; color: var(--accent-2); padding: 10px 20px; font-size: 13px; cursor: pointer; text-decoration: none; font-weight: 600; }\n    .btn:hover { border-color: var(--accent-2); background: rgba(42,143,168,0.08); }\n    .btn.accent { border-color: var(--accent); color: var(--accent); }\n    .btn.accent:hover { background: rgba(244,178,102,0.1); }\n    .company-group { margin-bottom: 24px; }\n    .company-group-header { font-size: 18px; font-weight: 700; color: var(--accent); padding: 12px 0 8px; border-bottom: 1px solid var(--border); margin-bottom: 16px; }\n    .person-card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 20px; margin-bottom: 16px; }\n    .person-header { display: flex; gap: 16px; align-items: flex-start; margin-bottom: 12px; }\n    .person-photo-wrap { flex-shrink: 0; }\n    .person-photo { width: 64px; height: 64px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border); }\n    .photo-placeholder { width: 64px; height: 64px; border-radius: 50%; background: linear-gradient(135deg,var(--accent-2),var(--accent)); display: flex; align-items: center; justify-content: center; font-size: 28px; color: white; }\n    .person-info h3 { font-size: 18px; margin-bottom: 4px; }\n    .person-headline { color: var(--muted); font-size: 14px; }\n    .person-location { color: var(--muted); font-size: 13px; margin-top: 2px; }\n    .status-badge { display: inline-block; font-size: 11px; padding: 3px 10px; border-radius: 999px; margin-top: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }\n    .status-success { background: rgba(22,163,74,0.1); color: var(--green); border: 1px solid rgba(22,163,74,0.25); }\n    .status-failed { background: rgba(220,38,38,0.1); color: var(--red); border: 1px solid rgba(220,38,38,0.25); }\n    .status-pending { background: rgba(212,138,46,0.1); color: var(--accent); border: 1px solid rgba(212,138,46,0.25); }\n    .person-summary { color: var(--muted); font-size: 13px; line-height: 1.5; margin-bottom: 12px; padding: 8px 12px; background: rgba(0,0,0,0.02); border-radius: 8px; }\n    .section { margin-top: 14px; padding-top: 12px; border-top: 1px solid var(--border); }\n    .section-title { font-size: 14px; font-weight: 700; color: var(--accent-2); margin-bottom: 8px; letter-spacing: 0.5px; }\n    .subsection { margin-bottom: 10px; }\n    .subsection strong { display: block; font-size: 12px; color: var(--muted); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }\n    .contact-item { display: flex; align-items: center; gap: 8px; padding: 4px 0; flex-wrap: wrap; }\n    .contact-badge { background: var(--chip); border: 1px solid var(--border); border-radius: 4px; padding: 2px 8px; font-size: 11px; color: var(--accent); text-transform: uppercase; min-width: 60px; text-align: center; }\n    .contact-value { color: var(--accent-2); text-decoration: none; font-size: 14px; }\n    .contact-value:hover { text-decoration: underline; }\n    .rating { font-size: 11px; color: var(--accent); }\n    .no-data { color: var(--muted); font-size: 13px; font-style: italic; padding: 2px 0; }\n    .social-links { display: flex; gap: 8px; flex-wrap: wrap; }\n    .social-link { background: var(--chip); border: 1px solid var(--border); border-radius: 6px; padding: 4px 12px; color: var(--accent-2); text-decoration: none; font-size: 13px; }\n    .social-link:hover { border-color: var(--accent-2); background: rgba(42,143,168,0.08); }\n    .skills-wrap { display: flex; flex-wrap: wrap; gap: 6px; }\n    .skill-chip { background: var(--chip); border: 1px solid var(--border); border-radius: 999px; padding: 4px 12px; font-size: 12px; color: var(--muted); }\n    .exp-item { padding: 8px 0; border-bottom: 1px solid rgba(0,0,0,0.03); }\n    .exp-item:last-child { border-bottom: none; }\n    .exp-title { font-weight: 600; font-size: 14px; }\n    .exp-company { color: var(--muted); font-size: 13px; }\n    .exp-tag { display: inline-block; background: var(--chip); border: 1px solid var(--border); border-radius: 4px; padding: 2px 8px; font-size: 11px; color: var(--muted); margin: 4px 4px 0 0; }\n    .exp-summary { color: var(--muted); font-size: 12px; margin-top: 4px; line-height: 1.4; }\n    .edu-item { padding: 6px 0; font-size: 14px; }\n    .date-range { color: var(--muted); font-size: 12px; }\n    .lang-wrap { display: flex; gap: 8px; flex-wrap: wrap; }\n    .lang-chip { background: var(--chip); border: 1px solid var(--border); border-radius: 6px; padding: 4px 12px; font-size: 12px; color: var(--muted); }\n    .cert-item { padding: 4px 0; font-size: 13px; color: var(--muted); }\n    .empty-state { text-align: center; padding: 60px 20px; }\n    .empty-icon { font-size: 48px; margin-bottom: 16px; }\n    .empty-state h3 { font-size: 22px; margin-bottom: 12px; }\n    .empty-state p { color: var(--muted); font-size: 14px; max-width: 500px; margin: 0 auto 8px; line-height: 1.6; }\n    .empty-state .note { font-size: 12px; color: var(--accent); background: rgba(212,138,46,0.06); border: 1px solid rgba(212,138,46,0.2); border-radius: 8px; padding: 12px; margin-top: 16px; display: inline-block; }\n    .section-label { font-size: 16px; font-weight: 700; color: var(--accent-2); margin: 24px 0 12px; padding: 10px 16px; background: var(--card); border: 1px solid var(--border); border-radius: 10px; display: flex; align-items: center; gap: 8px; }\n    .section-label .badge { background: var(--accent-2); color: white; font-size: 12px; padding: 2px 10px; border-radius: 999px; font-weight: 600; }\n    .prev-check-wrap { display: flex; align-items: center; gap: 8px; padding: 0; }\n    .prev-check-wrap input[type=checkbox] { width: 16px; height: 16px; accent-color: var(--accent); cursor: pointer; }\n    .prev-check-wrap label { font-size: 13px; font-weight: 600; color: var(--muted); cursor: pointer; user-select: none; }\n    .prev-check-wrap .prev-count { background: var(--chip); border: 1px solid var(--border); color: var(--muted); font-size: 11px; padding: 2px 8px; border-radius: 999px; font-weight: 600; margin-left: 2px; }\n    .previous-section { display: none; margin-top: 24px; }\n    .previous-section.show { display: block; }\n    .previous-divider { font-size: 15px; font-weight: 700; color: var(--muted); margin: 0 0 12px; padding: 10px 16px; background: var(--card); border: 1px solid var(--border); border-radius: 10px; display: flex; align-items: center; gap: 8px; }\n    .previous-divider .badge { background: var(--muted); color: white; font-size: 12px; padding: 2px 10px; border-radius: 999px; font-weight: 600; }\n    .replyio-bar { display: flex; align-items: center; gap: 12px; padding: 14px 18px; background: rgba(42,143,168,0.06); border: 1px solid rgba(42,143,168,0.15); border-radius: 10px; margin-bottom: 16px; flex-wrap: wrap; }\n    .replyio-bar select { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 8px 12px; font-size: 13px; color: var(--text); min-width: 240px; outline: none; font-family: inherit; }\n    .replyio-bar select:focus { border-color: var(--accent-2); }\n    .replyio-count { font-weight: 600; color: var(--accent-2); font-size: 14px; white-space: nowrap; }\n    .btn-replyio { background: linear-gradient(135deg, var(--accent-2), #4db8cc); border: none; color: white; padding: 8px 18px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; font-family: inherit; white-space: nowrap; }\n    .btn-replyio:disabled { opacity: 0.5; cursor: not-allowed; }\n    .btn-fetch-seq { background: rgba(42,143,168,0.08); border: 1px solid rgba(42,143,168,0.2); color: var(--accent-2); padding: 8px 14px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 12px; font-family: inherit; white-space: nowrap; }\n    .btn-fetch-seq:hover { background: rgba(42,143,168,0.15); }\n    .select-all-bar { display: flex; align-items: center; gap: 16px; margin-bottom: 12px; }\n    .select-all-bar label { display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px; color: var(--muted); font-weight: 600; }\n    .select-all-bar input[type=checkbox] { width: 16px; height: 16px; accent-color: var(--accent); cursor: pointer; }\n    .replyio-status { font-size: 13px; margin-left: 4px; }\n    .replyio-status.success { color: var(--green); font-weight: 600; }\n    .replyio-status.error { color: var(--red); font-weight: 600; }\n    .card-inner { display: flex; gap: 12px; align-items: flex-start; }\n    .card-inner > input[type=checkbox] { width: 18px; height: 18px; accent-color: var(--accent-2); cursor: pointer; flex-shrink: 0; margin-top: 22px; }\n    .card-inner > .card-content { flex: 1; min-width: 0; }\n    @media (max-width: 768px) { .person-header { flex-direction: column; } .toolbar input { width: 100%; } .replyio-bar { flex-direction: column; align-items: flex-start; } }\n  </style>\n</head>\n<body>\n  <script>var PEOPLE_DATA = ${peopleDataJson};</script>\\n  <script>var SEQUENCES_DATA = ${sequencesJson};</script>\n  <header>\n    <div><h1>Enriched People Data</h1><div class=\"sub\">Full contact details, experience, education, and social links for enriched people.</div></div>\n    <div class=\"stats\">\n      <span class=\"chip accent\">${currentCount} current session</span>\n      <span class=\"chip\">${previousCount} previous</span>\n      <span class=\"chip\">${totalPeople} total people</span>\n    </div>\n  </header>\n  <div class=\"container\">\n    <div class=\"toolbar\">\n      <input type=\"text\" id=\"filterInput\" placeholder=\"Filter by name, company, skill, email...\" oninput=\"filterCards()\" />\n      <div style=\"display:flex;gap:8px\">\n        <a class=\"btn accent\" href=\"/webhook/jobs-ui\">Back to Jobs</a>\n        <button class=\"btn\" onclick=\"location.reload()\">Refresh</button>\n      </div>\n    </div>\n    <div class=\"replyio-bar\"><span class=\"replyio-count\"><span id=\"sel-count\">0</span> selected</span><select id=\"seq-select\"><option value=\"\">-- Select a sequence --</option></select><button class=\"btn-fetch-seq\" onclick=\"location.reload()\">Refresh Sequences</button><button class=\"btn-replyio\" id=\"send-btn\" disabled onclick=\"sendToSequence()\">Send to Sequence</button><span class=\"replyio-status\" id=\"replyio-status\"></span></div>\n    <div class=\"select-all-bar\"><label><input type=\"checkbox\" id=\"select-all-cb\" onchange=\"toggleSelectAll()\" /> Select All Visible</label><label><input type=\"checkbox\" id=\"deselect-all-cb\" onchange=\"deselectAll()\" /> Deselect All</label></div>\n    ${totalPeople === 0 ? '<div id=\"results\">' + emptyHtml + '</div>' : (previousCount > 0 ? '<div style=\"display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-bottom:8px\"><div class=\"section-label\" style=\"margin:0;flex:1\"><span>&#9889; Current Session</span><span class=\"badge\">' + currentCount + ' people across ' + currentCompanies.length + ' companies</span></div><div class=\"prev-check-wrap\"><input type=\"checkbox\" id=\"showPrevCheck\" onchange=\"togglePrevious()\"/><label for=\"showPrevCheck\">Show Previous Enrichments</label><span class=\"prev-count\">' + previousCount + '</span></div></div>' : '<div class=\"section-label\"><span>&#9889; Current Session</span><span class=\"badge\">' + currentCount + ' people across ' + currentCompanies.length + ' companies</span></div>') + '<div id=\"currentResults\">' + currentCardsHtml + '</div>' + (previousCount > 0 ? '<div class=\"previous-section\" id=\"prevSection\"><div class=\"previous-divider\"><span>&#128197; Previous Enrichments</span><span class=\"badge\">' + previousCount + ' people across ' + previousCompanies.length + ' companies</span></div>' + previousCardsHtml + '</div>' : '')}\n  </div>\n  <script>\n    function filterCards() {\n      var q = document.getElementById('filterInput').value.toLowerCase();\n      var cards = document.querySelectorAll('.person-card');\n      for (var i = 0; i < cards.length; i++) {\n        cards[i].style.display = cards[i].textContent.toLowerCase().indexOf(q) !== -1 ? '' : 'none';\n      }\n      var groups = document.querySelectorAll('.company-group');\n      for (var j = 0; j < groups.length; j++) {\n        var grp = groups[j];\n        var allCards = grp.querySelectorAll('.person-card');\n        var visibleCount = 0;\n        for (var k = 0; k < allCards.length; k++) {\n          if (allCards[k].style.display !== 'none') visibleCount++;\n        }\n        grp.style.display = visibleCount > 0 ? '' : 'none';\n      }\n    }\n    function togglePrevious() {\n      var cb = document.getElementById('showPrevCheck');\n      var section = document.getElementById('prevSection');\n      if (!cb || !section) return;\n      if (cb.checked) {\n        section.className = 'previous-section show';\n      } else {\n        section.className = 'previous-section';\n      }\n    }\n    function updateSelCount() {\n      var cbs = document.querySelectorAll('.person-cb');\n      var count = 0;\n      for (var i = 0; i < cbs.length; i++) { if (cbs[i].checked) count++; }\n      var el = document.getElementById('sel-count');\n      if (el) el.textContent = count;\n      var sendBtn = document.getElementById('send-btn');\n      var seqSel = document.getElementById('seq-select');\n      if (sendBtn) sendBtn.disabled = (count === 0 || !seqSel || !seqSel.value);\n    }\n    function toggleSelectAll() {\n      var master = document.getElementById('select-all-cb');\n      var checked = master ? master.checked : false;\n      var cbs = document.querySelectorAll('.person-card:not([style*=\"display: none\"]):not([style*=\"display:none\"]) .person-cb');\n      for (var i = 0; i < cbs.length; i++) { cbs[i].checked = checked; }\n      updateSelCount();\n    }\n    function deselectAll() {\n      var cbs = document.querySelectorAll('.person-cb');\n      for (var i = 0; i < cbs.length; i++) { cbs[i].checked = false; }\n      var sa = document.getElementById('select-all-cb');\n      var da = document.getElementById('deselect-all-cb');\n      if (sa) sa.checked = false;\n      if (da) da.checked = false;\n      updateSelCount();\n    }\n    function getBase() {\n      var path = window.location.pathname;\n      var useTest = path.indexOf('/webhook-test/') !== -1;\n      return window.location.origin + (useTest ? '/webhook-test/' : '/webhook/');\n    }\n    function loadSequencesFromData() {\n      var sel = document.getElementById('seq-select');\n      var status = document.getElementById('replyio-status');\n      var sequences = window.SEQUENCES_DATA || [];\n      if (sequences.length > 0) {\n        sel.innerHTML = '<option value=\"\">-- Select (' + sequences.length + ' found) --</option>';\n        for (var i = 0; i < sequences.length; i++) {\n          var opt = document.createElement('option');\n          opt.value = sequences[i].id;\n          opt.textContent = sequences[i].name;\n          sel.appendChild(opt);\n        }\n        status.textContent = sequences.length + ' sequences available';\n        status.className = 'replyio-status success';\n      } else {\n        sel.innerHTML = '<option value=\"\">-- No sequences found --</option>';\n        status.textContent = 'No sequences loaded';\n        status.className = 'replyio-status error';\n      }\n    }\n    loadSequencesFromData();\n    var seqSel = document.getElementById('seq-select');\n    if (seqSel) seqSel.onchange = function() { updateSelCount(); };\n    function buildContactsPayload() {\n      var cbs = document.querySelectorAll('.person-cb');\n      var contacts = [];\n      for (var i = 0; i < cbs.length; i++) {\n        if (!cbs[i].checked) continue;\n        var uid = cbs[i].getAttribute('data-uid');\n        if (!uid) continue;\n        var person = null;\n        for (var j = 0; j < PEOPLE_DATA.length; j++) {\n          if (PEOPLE_DATA[j].uid === uid) { person = PEOPLE_DATA[j]; break; }\n        }\n        if (!person) continue;\n        var emails = person.emails || [];\n        var bestEmail = '';\n        var bestRating = -1;\n        for (var e = 0; e < emails.length; e++) {\n          var rating = parseInt(emails[e].rating || '0', 10);\n          if (rating > bestRating) { bestRating = rating; bestEmail = emails[e].value || ''; }\n        }\n        if (!bestEmail && emails.length > 0) bestEmail = emails[0].value || '';\n        if (!bestEmail) continue;\n        var nameParts = (person.full_name || '').trim().split(' ');\n        var firstName = nameParts[0] || '';\n        var lastName = nameParts.length > 1 ? nameParts.slice(1).join(' ') : '';\n        var exp = person.experience_detailed || [];\n        var currentExp = null;\n        for (var x = 0; x < exp.length; x++) { if (exp[x].current) { currentExp = exp[x]; break; } }\n        if (!currentExp && exp.length > 0) currentExp = exp[0];\n        var links = person.social_links || [];\n        var linkedin = '';\n        for (var s = 0; s < links.length; s++) { if (links[s].type === 'li') { linkedin = links[s].link || ''; break; } }\n        var skills = person.skills || [];\n        var skillNames = [];\n        for (var sk = 0; sk < skills.length && sk < 8; sk++) {\n          var sn = typeof skills[sk] === 'string' ? skills[sk] : (skills[sk].name || '');\n          if (sn) skillNames.push(sn);\n        }\n        var contact = { email: bestEmail, firstName: firstName, lastName: lastName, company: person.display_company || '', customFields: [] };\n        contact.customFields.push({ key: 'email_', value: bestEmail });\n        contact.customFields.push({ key: 'firstName_', value: firstName });\n        contact.customFields.push({ key: 'company_', value: person.display_company || '' });\n        if (currentExp && currentExp.position) contact.customFields.push({ key: 'Position', value: currentExp.position });\n        if (linkedin) contact.customFields.push({ key: 'Linkedin_', value: linkedin });\n        if (person.location_name) contact.customFields.push({ key: 'Location', value: person.location_name });\n        if (person.headline) contact.customFields.push({ key: 'Headline', value: person.headline });\n        if (currentExp && currentExp.industry) contact.customFields.push({ key: 'Industry_', value: currentExp.industry });\n        if (currentExp && currentExp.companySize) contact.customFields.push({ key: 'Company_Size', value: currentExp.companySize });\n        if (skillNames.length > 0) contact.customFields.push({ key: 'Skills', value: skillNames.join(', ') });\n        var allEmails = [];\n        for (var ae = 0; ae < emails.length; ae++) { if (emails[ae].value) allEmails.push(emails[ae].value); }\n        if (allEmails.length > 1) contact.customFields.push({ key: 'All_Emails_', value: allEmails.join(', ') });\n        var phones = person.phones || [];\n        if (phones.length > 0 && phones[0].value) contact.customFields.push({ key: 'Phone_', value: phones[0].value });\n        contacts.push(contact);\n      }\n      return contacts;\n    }\n    function sendToSequence() {\n      var sel = document.getElementById('seq-select');\n      var campaignId = sel ? sel.value : '';\n      if (!campaignId) { alert('Please select a sequence first.'); return; }\n      var contacts = buildContactsPayload();\n      if (contacts.length === 0) { alert('No selected people have valid email addresses.'); return; }\n      if (!confirm('Send ' + contacts.length + ' contacts to the selected sequence?')) return;\n      var form = document.createElement('form');\n      form.method = 'POST';\n      form.action = getBase() + 'replyio-send';\n      var inp = document.createElement('input');\n      inp.type = 'hidden';\n      inp.name = 'payload';\n      inp.value = JSON.stringify({ campaignId: Number(campaignId), contacts: contacts });\n      form.appendChild(inp);\n      document.body.appendChild(form);\n      form.submit();\n    }\n  </script>\n</body>\n</html>`;\n\nreturn [{ json: { html } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1088,
        2656
      ],
      "id": "b3982f32-1b3f-4d0f-ac57-5f4c0808dbf7",
      "name": "Build Enriched UI HTML"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.html}}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=UTF-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        1328,
        2656
      ],
      "id": "acf3df18-dfc8-4458-8e7f-cadb7a828cc7",
      "name": "Enriched UI Response"
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://api.reply.io/v1/campaigns",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-Api-Key",
              "value": "={{ $env.REPLYIO_API_KEY }}"
            }
          ]
        },
        "options": {
          "timeout": 15000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        848,
        2960
      ],
      "id": "b2c3d4e5-f6a7-8901-bc02-replycampapi",
      "name": "Call Reply.io Campaigns API",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "replyio-send",
        "responseMode": "responseNode",
        "options": {},
        "authentication": "headerAuth"
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        608,
        3260
      ],
      "id": "e5f6a7b8-c9d0-1234-ef05-replysendpost",
      "name": "Send to Reply.io (POST)",
      "webhookId": "f1a2b3c4-d5e6-7890-abcd-replysendwh1",
      "credentials": {
        "httpHeaderAuth": {
          "id": "WEBHOOK_AUTH_CRED_ID",
          "name": "Webhook Auth Header"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const raw = $json.body || $json;\nconst payload = typeof raw.payload === 'string' ? JSON.parse(raw.payload) : raw;\nconst campaignId = payload.campaignId;\nconst contacts = payload.contacts || [];\n\nif (!campaignId || !contacts.length) {\n  return [{ json: { error: 'Missing campaignId or contacts', campaignId: campaignId || null, contactCount: contacts.length } }];\n}\n\nconst formatted = contacts.map(c => {\n  const out = {\n    email: String(c.email || '').trim(),\n    firstName: String(c.firstName || '').trim(),\n    lastName: String(c.lastName || '').trim(),\n    company: String(c.company || '').trim()\n  };\n  if (Array.isArray(c.customFields)) {\n    out.customFields = c.customFields.map(f => ({\n      key: String(f.key || ''),\n      value: String(f.value || '').substring(0, 500)\n    })).filter(f => f.key && f.value);\n  }\n  return out;\n}).filter(c => c.email);\n\nif (formatted.length === 0) {\n  return [{ json: { error: 'No contacts with valid email addresses', campaignId: campaignId, contactCount: 0 } }];\n}\n\nreturn [{ json: {\n  apiPayload: {\n    campaignId: Number(campaignId),\n    contacts: formatted\n  },\n  contactCount: formatted.length,\n  skipped: contacts.length - formatted.length\n} }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        848,
        3260
      ],
      "id": "f6a7b8c9-d0e1-2345-f006-procsendreq01",
      "name": "Process Reply.io Send Request"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.reply.io/v1/Actions/pushContactsToSequence",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-Api-Key",
              "value": "={{ $env.REPLYIO_API_KEY }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json.apiPayload) }}",
        "options": {
          "timeout": 30000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1088,
        3260
      ],
      "id": "a7b8c9d0-e1f2-3456-a107-pushcontacts1",
      "name": "Push Contacts to Reply.io",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=<!DOCTYPE html><html><head><meta charset=\"utf-8\"><title>Reply.io Send Result</title><style>body{font-family:\"Segoe UI\",sans-serif;background:#f4f6fb;display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0}.card{background:#fff;border:1px solid #d8dde8;border-radius:16px;padding:40px;text-align:center;max-width:480px;width:90%}.icon{font-size:48px;margin-bottom:16px}.title{font-size:22px;font-weight:700;margin-bottom:12px}.msg{color:#5f6b82;font-size:14px;line-height:1.6;margin-bottom:24px}.btn{display:inline-block;background:#2a8fa8;color:#fff;padding:12px 28px;border-radius:8px;text-decoration:none;font-weight:600;font-size:14px}.btn:hover{background:#237d93}.error{color:#dc2626}.success{color:#16a34a}</style></head><body><div class=\"card\">{{ $json.error ? '<div class=\"icon\">&#10060;</div><div class=\"title error\">Error</div><div class=\"msg\">' + $json.error + '</div>' : '<div class=\"icon\">&#9989;</div><div class=\"title success\">Contacts Pushed Successfully</div><div class=\"msg\">' + ($json.contactCount || 0) + ' contacts sent to Reply.io sequence' + ($json.skipped ? ' (' + $json.skipped + ' skipped)' : '') + '</div>' }}<a class=\"btn\" href=\"/webhook/enriched-ui\">Back to Enriched Data</a></div></body></html>",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=UTF-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        1328,
        3260
      ],
      "id": "b8c9d0e1-f2a3-4567-b208-replysendresp",
      "name": "Reply.io Send Response"
    }
  ],
  "pinData": {},
  "connections": {
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Jobs UI (GET)": {
      "main": [
        [
          {
            "node": "Fetch Jobs for UI (MySQL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Jobs for UI (MySQL)": {
      "main": [
        [
          {
            "node": "Build Jobs UI HTML (Server)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Jobs UI HTML (Server)": {
      "main": [
        [
          {
            "node": "Jobs UI Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Jobs UI Data (GET)": {
      "main": [
        [
          {
            "node": "Build Jobs Data Query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Jobs Data Query": {
      "main": [
        [
          {
            "node": "Fetch Jobs Data (MySQL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Jobs Data (MySQL)": {
      "main": [
        [
          {
            "node": "Build Jobs Data Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Jobs Data Response": {
      "main": [
        [
          {
            "node": "Jobs Data Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Jobs UI Submit (POST)": {
      "main": [
        [
          {
            "node": "Build Submit Query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Submit Query": {
      "main": [
        [
          {
            "node": "Fetch Selected Jobs (MySQL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Selected Jobs (MySQL)": {
      "main": [
        [
          {
            "node": "Filter Selected Jobs (Submit)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Selected Jobs (Submit)": {
      "main": [
        [
          {
            "node": "Prepare Company Search",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Daily Schedule (9AM EST)2": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Job Scraper2": {
      "main": [
        [
          {
            "node": "Split Out2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Alert - Job Scraper",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out2": {
      "main": [
        [
          {
            "node": "Prepare Job Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Job Data": {
      "main": [
        [
          {
            "node": "MySQL Insert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Job Scraper2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Leaders UI HTML": {
      "main": [
        [
          {
            "node": "Selection Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Company Search": {
      "main": [
        [
          {
            "node": "Search SignalHire Leaders",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search SignalHire Leaders": {
      "main": [
        [
          {
            "node": "Prepare AI Analysis",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare AI Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare AI Analysis": {
      "main": [
        [
          {
            "node": "Claude Pick Best Leaders",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Claude Pick Best Leaders": {
      "main": [
        [
          {
            "node": "Process AI Picks",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Process AI Picks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process AI Picks": {
      "main": [
        [
          {
            "node": "Save People to DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save People to DB": {
      "main": [
        [
          {
            "node": "Create People Table (MySQL)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Create Enriched Table (MySQL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create People Table (MySQL)": {
      "main": [
        [
          {
            "node": "Insert People (MySQL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert People (MySQL)": {
      "main": [
        [
          {
            "node": "Build Leaders UI HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enrich Submit (POST)": {
      "main": [
        [
          {
            "node": "Process Enrich Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Enrich Request": {
      "main": [
        [
          {
            "node": "Call SignalHire Person API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call SignalHire Person API": {
      "main": [
        [
          {
            "node": "Enrich Response",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Enrich Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SignalHire Callback (POST)": {
      "main": [
        [
          {
            "node": "Process Callback Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Callback Data": {
      "main": [
        [
          {
            "node": "Save Enriched Data (MySQL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Enriched Data (MySQL)": {
      "main": [
        [
          {
            "node": "Callback Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enriched Data UI (GET)": {
      "main": [
        [
          {
            "node": "Fetch Enriched Data (MySQL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Enriched Data (MySQL)": {
      "main": [
        [
          {
            "node": "Call Reply.io Campaigns API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Enriched UI HTML": {
      "main": [
        [
          {
            "node": "Enriched UI Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call Reply.io Campaigns API": {
      "main": [
        [
          {
            "node": "Build Enriched UI HTML",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Build Enriched UI HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send to Reply.io (POST)": {
      "main": [
        [
          {
            "node": "Process Reply.io Send Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Reply.io Send Request": {
      "main": [
        [
          {
            "node": "Push Contacts to Reply.io",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Push Contacts to Reply.io": {
      "main": [
        [
          {
            "node": "Reply.io Send Response",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Reply.io Send Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "3bf20395-7896-4155-8534-c95a45efe497",
  "meta": {
    "instanceId": "238e209ef863af056f51ef319ce60e54301f4959b4ddfd37a8126b18abdcba6f"
  },
  "id": "YmXQzaBXPi8po228ZIwem",
  "tags": []
}